make examples
make[1]: Entering directory '/home/jglass/Documents/pyscript/pyscriptjs'
mkdir -p ./examples
cp -r ../examples/* ./examples
chmod -R 755 examples
find ./examples/toga -type f -name '*.html' -exec sed -i s+https://pyscript.net/latest/+../../build/+g {} \;
find ./examples/webgl -type f -name '*.html' -exec sed -i s+https://pyscript.net/latest/+../../../build/+g {} \;
find ./examples -type f -name '*.html' -exec sed -i s+https://pyscript.net/latest/+../build/+g {} \;
npm run build

> pyscript@0.0.1 build
> npm run tsc && node esbuild.mjs


> pyscript@0.0.1 tsc
> tsc --noEmit

[1mpyscript[0m [2m(prod)[0m built in: 81.967ms
rm -rf ./examples/build
mkdir -p ./examples/build
cp -R ./build/* ./examples/build
To serve examples run: conda run -p /home/jglass/Documents/pyscript/pyscriptjs/env python -m http.server 8080 --directory examples
make[1]: Leaving directory '/home/jglass/Documents/pyscript/pyscriptjs'
make test-ts
make[1]: Entering directory '/home/jglass/Documents/pyscript/pyscriptjs'
npm run test

> pyscript@0.0.1 test
> cross-env NODE_OPTIONS=--experimental-vm-modules jest --coverage

  console.error
    Something went wrong!

      72 |     switch (`log-${level}-${logMessage}`) {
      73 |         case 'log-error-true':
    > 74 |             console.error(message);
         |                     ^
      75 |             break;
      76 |         case 'log-warning-true':
      77 |             console.warn(message);

      at error (src/exceptions.ts:74:21)
      at Object.<anonymous> (tests/unit/exceptions.test.ts:11:9)

  console.warn
    This is a warning

      75 |             break;
      76 |         case 'log-warning-true':
    > 77 |             console.warn(message);
         |                     ^
      78 |             break;
      79 |     }
      80 |

      at warn (src/exceptions.ts:77:21)
      at Object.<anonymous> (tests/unit/exceptions.test.ts:21:9)

  console.error
    Something went wrong!

      72 |     switch (`log-${level}-${logMessage}`) {
      73 |         case 'log-error-true':
    > 74 |             console.error(message);
         |                     ^
      75 |             break;
      76 |         case 'log-warning-true':
      77 |             console.warn(message);

      at console.<anonymous> (node_modules/jest-mock/build/index.js:709:23)
      at error (src/exceptions.ts:74:21)
      at Object.<anonymous> (tests/unit/exceptions.test.ts:33:9)

  console.warn
    This warning

      75 |             break;
      76 |         case 'log-warning-true':
    > 77 |             console.warn(message);
         |                     ^
      78 |             break;
      79 |     }
      80 |

      at console.<anonymous> (node_modules/jest-mock/build/index.js:709:23)
      at warn (src/exceptions.ts:77:21)
      at Object.<anonymous> (tests/unit/exceptions.test.ts:41:9)

  console.warn
    Warning!

      75 |             break;
      76 |         case 'log-warning-true':
    > 77 |             console.warn(message);
         |                     ^
      78 |             break;
      79 |     }
      80 |

      at console.<anonymous> (node_modules/jest-mock/build/index.js:709:23)
      at warn (src/exceptions.ts:77:21)
      at Object.<anonymous> (tests/unit/exceptions.test.ts:50:9)

  console.error
    <p>Test message</p>

      72 |     switch (`log-${level}-${logMessage}`) {
      73 |         case 'log-error-true':
    > 74 |             console.error(message);
         |                     ^
      75 |             break;
      76 |         case 'log-warning-true':
      77 |             console.warn(message);

      at console.<anonymous> (node_modules/jest-mock/build/index.js:709:23)
      at error (src/exceptions.ts:74:21)
      at Object.<anonymous> (tests/unit/exceptions.test.ts:85:9)

  console.error
    <p>Test message</p>

      72 |     switch (`log-${level}-${logMessage}`) {
      73 |         case 'log-error-true':
    > 74 |             console.error(message);
         |                     ^
      75 |             break;
      76 |         case 'log-warning-true':
      77 |             console.warn(message);

      at console.<anonymous> (node_modules/jest-mock/build/index.js:709:23)
      at error (src/exceptions.ts:74:21)
      at Object.<anonymous> (tests/unit/exceptions.test.ts:98:9)

  console.warn
    A unique error message

      75 |             break;
      76 |         case 'log-warning-true':
    > 77 |             console.warn(message);
         |                     ^
      78 |             break;
      79 |     }
      80 |

      at warn (src/exceptions.ts:77:21)
      at _createAlertBanner (src/utils.ts:112:9)
      at Object.<anonymous> (tests/unit/utils.test.ts:57:13)

  console.info
    [py-config] loading <py-config> content

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.info
    [py-config] loading  /covfefe.json

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.info
    [py-config] loading  /covfefe.json

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.info
    [py-config] loading <py-config> content

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.info
    [py-config] loading <py-config> content

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.info
    [py-config] loading <py-config> content

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.info
    [py-config] loading <py-config> content

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.info
    [py-config] loading  /covfefe.json

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.info
    [py-config] loading  /covfefe.json

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.info
    [py-config] loading <py-config> content

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.info
    [py-config] loading <py-config> content

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.info
    [py-config] loading <py-config> content

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.info
    [py-config] loading <py-config> content

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.error
    (PY0000): Computer says no

      72 |     switch (`log-${level}-${logMessage}`) {
      73 |         case 'log-error-true':
    > 74 |             console.error(message);
         |                     ^
      75 |             break;
      76 |         case 'log-warning-true':
      77 |             console.warn(message);

      at error (src/exceptions.ts:74:21)
      at MyApp._createAlertBanner [as _handleUserErrorMaybe] (src/main.ts:136:13)
      at MyApp._handleUserErrorMaybe [as main] (src/main.ts:115:24)
      at Object.<anonymous> (tests/unit/main.test.ts:30:9)

  console.error
    (PY0000): hello <br>

      72 |     switch (`log-${level}-${logMessage}`) {
      73 |         case 'log-error-true':
    > 74 |             console.error(message);
         |                     ^
      75 |             break;
      76 |         case 'log-warning-true':
      77 |             console.warn(message);

      at error (src/exceptions.ts:74:21)
      at MyApp._createAlertBanner [as _handleUserErrorMaybe] (src/main.ts:136:13)
      at MyApp._handleUserErrorMaybe [as main] (src/main.ts:115:24)
      at Object.<anonymous> (tests/unit/main.test.ts:42:9)

  console.error
    (PY0000): hello <br>

      72 |     switch (`log-${level}-${logMessage}`) {
      73 |         case 'log-error-true':
    > 74 |             console.error(message);
         |                     ^
      75 |             break;
      76 |         case 'log-warning-true':
      77 |             console.warn(message);

      at error (src/exceptions.ts:74:21)
      at MyApp._createAlertBanner [as _handleUserErrorMaybe] (src/main.ts:136:13)
      at MyApp._handleUserErrorMaybe [as main] (src/main.ts:115:24)
      at Object.<anonymous> (tests/unit/main.test.ts:54:9)

  console.info
    [pyscript/pyodide] importing pyscript

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.info
    [pyscript/pyodide] pyodide loaded and initialized

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.info
    [pyscript/pyodide] pyodide.loadPackage: numpy

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.info
    [pyscript/pyodide] Loading numpy

      at Object.out_fn [as info] (src/logger.ts:50:13)

  console.log
    Didn't find package numpy-1.23.5-cp310-cp310-emscripten_3_1_27_wasm32.whl locally, attempting to load from https://cdn.jsdelivr.net/pyodide/v0.22.1/full/

      at node_modules/pyodide/pyodide.asm.js:10:141811
          at async Promise.all (index 0)

  console.log
    Package numpy-1.23.5-cp310-cp310-emscripten_3_1_27_wasm32.whl loaded from https://cdn.jsdelivr.net/pyodide/v0.22.1/full/, caching the wheel in node_modules for future use.

      at node_modules/pyodide/pyodide.asm.js:10:141959
          at async Promise.all (index 0)

  console.info
    [pyscript/pyodide] Loaded numpy

      at Object.out_fn [as info] (src/logger.ts:50:13)

---------------------------|---------|----------|---------|---------|---------------------------------
File                       | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s               
---------------------------|---------|----------|---------|---------|---------------------------------
All files                  |    37.2 |    42.47 |   38.21 |   37.73 |                                 
 pyscriptjs                |     100 |    83.33 |     100 |     100 |                                 
  directoryManifest.mjs    |     100 |    83.33 |     100 |     100 | 40                              
 pyscriptjs/src            |   53.07 |    59.23 |   51.18 |   54.56 |                                 
  exceptions.ts            |   95.34 |      100 |   83.33 |   95.34 | 61-62                           
  fetch.ts                 |   94.11 |    88.88 |     100 |   94.11 | 53                              
  interpreter_client.ts    |   56.25 |      100 |   42.85 |   56.25 | 75-92                           
  logger.ts                |     100 |      100 |     100 |     100 |                                 
  main.ts                  |    16.9 |       20 |   17.39 |   16.54 | 35-37,120-129,147-434,443       
  plugin.ts                |   14.28 |        0 |   16.66 |   15.38 | 150-218,243-267                 
  pyconfig.ts              |   86.31 |    74.41 |    92.3 |   86.31 | 117,121,128,177,211-225         
  pyexec.ts                |    4.34 |        0 |       0 |    4.34 | 14-73                           
  remote_interpreter.ts    |      45 |     9.09 |   45.45 |      45 | 104,134-135,146,166-255,268-273 
  stdio.ts                 |   96.77 |       70 |     100 |   96.55 | 73                              
  utils.ts                 |   73.58 |       65 |   63.63 |   77.55 | 4-11,45,58,92,130-134           
  version.ts               |     100 |      100 |     100 |     100 |                                 
 pyscriptjs/src/components |    2.76 |        0 |       0 |    2.76 |                                 
  elements.ts              |       0 |      100 |       0 |       0 | 7-11                            
  pyrepl.ts                |    2.38 |        0 |       0 |    2.38 | 36-224                          
  pyscript.ts              |     3.5 |        0 |       0 |     3.5 | 26-70,170-250                   
  pywidget.ts              |    2.77 |        0 |       0 |    2.77 | 14-100                          
 pyscriptjs/src/plugins    |   14.76 |    21.53 |      20 |   14.58 |                                 
  calculateFetchPaths.ts   |     100 |      100 |     100 |     100 |                                 
  importmap.ts             |    5.55 |        0 |       0 |    6.25 | 24-50                           
  pyterminal.ts            |    8.69 |        0 |    9.09 |    9.09 | 14-24,38-138                    
  splashscreen.ts          |    9.09 |     7.69 |   11.11 |    9.09 | 31-62,69-107                    
  stdiodirector.ts         |       5 |        0 |      20 |       5 | 34-128                          
---------------------------|---------|----------|---------|---------|---------------------------------
make[1]: Leaving directory '/home/jglass/Documents/pyscript/pyscriptjs'
make test-py
make[1]: Entering directory '/home/jglass/Documents/pyscript/pyscriptjs'
Tests from /home/jglass/Documents/pyscript/pyscriptjs/src
mkdir -p test_results
/home/jglass/Documents/pyscript/pyscriptjs/env/bin/pytest -vv  tests/py-unit/ --log-cli-level=warning --junitxml=test_results/py-unit.xml
============================= test session starts ==============================
platform linux -- Python 3.11.0, pytest-7.1.2, pluggy-1.0.0 -- /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python
cachedir: .pytest_cache
Test order randomisation NOT enabled. Enable with --random-order or --random-order-bucket=<bucket_type>
rootdir: /home/jglass/Documents/pyscript/pyscriptjs
plugins: random-order-1.1.0, base-url-2.0.0, playwright-0.3.2, xdist-3.2.1, instafail-0.5.0
collecting ... collected 19 items

tests/py-unit/test_pyscript.py::TestElement::test_id_is_correct PASSED   [  5%]
tests/py-unit/test_pyscript.py::TestElement::test_element PASSED         [ 10%]
tests/py-unit/test_pyscript.py::test_format_mime_str PASSED              [ 15%]
tests/py-unit/test_pyscript.py::test_format_mime_str_escaping PASSED     [ 21%]
tests/py-unit/test_pyscript.py::test_format_mime_repr_escaping PASSED    [ 26%]
tests/py-unit/test_pyscript.py::test_format_mime_HTML PASSED             [ 31%]
tests/py-unit/test_pyscript.py::test_uses_top_level_await PASSED         [ 36%]
tests/py-unit/test_pyscript.py::test_set_version_info PASSED             [ 42%]
tests/py-unit/test_pyscript.py::TestDeprecatedGlobal::test_repr PASSED   [ 47%]
tests/py-unit/test_pyscript.py::TestDeprecatedGlobal::test_show_warning_override PASSED [ 52%]
tests/py-unit/test_pyscript.py::TestDeprecatedGlobal::test_getattr PASSED [ 57%]
tests/py-unit/test_pyscript.py::TestDeprecatedGlobal::test_dont_show_warning_twice PASSED [ 63%]
tests/py-unit/test_pyscript.py::TestDeprecatedGlobal::test_call PASSED   [ 68%]
tests/py-unit/test_pyscript.py::TestDeprecatedGlobal::test_iter PASSED   [ 73%]
tests/py-unit/test_pyscript.py::TestDeprecatedGlobal::test_getitem PASSED [ 78%]
tests/py-unit/test_pyscript.py::TestDeprecatedGlobal::test_setitem PASSED [ 84%]
tests/py-unit/test_python_plugins.py::TestPyMarkdown::test_plugin_hooks PASSED [ 89%]
tests/py-unit/test_python_plugins.py::TestPyTutor::test_connected_calls PASSED [ 94%]
tests/py-unit/test_python_plugins.py::TestPyTutor::test_plugin_registered PASSED [100%]

=============================== warnings summary ===============================
src/python/pyscript/__init__.py:26
  /home/jglass/Documents/pyscript/pyscriptjs/src/python/pyscript/__init__.py:26: DeprecationWarning: There is no current event loop
    loop = asyncio.get_event_loop()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
- generated xml file: /home/jglass/Documents/pyscript/pyscriptjs/test_results/py-unit.xml -
======================== 19 passed, 1 warning in 0.05s =========================
make[1]: Leaving directory '/home/jglass/Documents/pyscript/pyscriptjs'
make test-integration-parallel
make[1]: Entering directory '/home/jglass/Documents/pyscript/pyscriptjs'
make examples
make[2]: Entering directory '/home/jglass/Documents/pyscript/pyscriptjs'
mkdir -p ./examples
cp -r ../examples/* ./examples
chmod -R 755 examples
find ./examples/toga -type f -name '*.html' -exec sed -i s+https://pyscript.net/latest/+../../build/+g {} \;
find ./examples/webgl -type f -name '*.html' -exec sed -i s+https://pyscript.net/latest/+../../../build/+g {} \;
find ./examples -type f -name '*.html' -exec sed -i s+https://pyscript.net/latest/+../build/+g {} \;
npm run build

> pyscript@0.0.1 build
> npm run tsc && node esbuild.mjs


> pyscript@0.0.1 tsc
> tsc --noEmit

[1mpyscript[0m [2m(prod)[0m built in: 82.617ms
rm -rf ./examples/build
mkdir -p ./examples/build
cp -R ./build/* ./examples/build
To serve examples run: conda run -p /home/jglass/Documents/pyscript/pyscriptjs/env python -m http.server 8080 --directory examples
make[2]: Leaving directory '/home/jglass/Documents/pyscript/pyscriptjs'
mkdir -p test_results
/home/jglass/Documents/pyscript/pyscriptjs/env/bin/pytest --numprocesses auto -vv  tests/integration/ --log-cli-level=warning --junitxml=test_results/integration.xml --instafail --random-order-bucket=global
gw0 I / gw1 I / gw2 I / gw3 I / gw4 I / gw5 I / gw6 I / gw7 I
[gw0] linux Python 3.11.0 cwd: /home/jglass/Documents/pyscript/pyscriptjs
[gw1] linux Python 3.11.0 cwd: /home/jglass/Documents/pyscript/pyscriptjs
[gw2] linux Python 3.11.0 cwd: /home/jglass/Documents/pyscript/pyscriptjs
[gw3] linux Python 3.11.0 cwd: /home/jglass/Documents/pyscript/pyscriptjs
[gw4] linux Python 3.11.0 cwd: /home/jglass/Documents/pyscript/pyscriptjs
[gw5] linux Python 3.11.0 cwd: /home/jglass/Documents/pyscript/pyscriptjs
[gw6] linux Python 3.11.0 cwd: /home/jglass/Documents/pyscript/pyscriptjs
[gw7] linux Python 3.11.0 cwd: /home/jglass/Documents/pyscript/pyscriptjs
============================= test session starts ==============================
platform linux -- Python 3.11.0, pytest-7.1.2, pluggy-1.0.0 -- /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python
cachedir: .pytest_cache
Using --random-order-bucket=global
Using --random-order-seed=224970

rootdir: /home/jglass/Documents/pyscript/pyscriptjs
plugins: random-order-1.1.0, base-url-2.0.0, playwright-0.3.2, xdist-3.2.1, instafail-0.5.0
collecting ... [gw0] Python 3.11.0 (main, Jan 16 2023, 14:19:54) [GCC 11.2.0]
[gw2] Python 3.11.0 (main, Jan 16 2023, 14:19:54) [GCC 11.2.0]
[gw1] Python 3.11.0 (main, Jan 16 2023, 14:19:54) [GCC 11.2.0]
[gw3] Python 3.11.0 (main, Jan 16 2023, 14:19:54) [GCC 11.2.0]
[gw4] Python 3.11.0 (main, Jan 16 2023, 14:19:54) [GCC 11.2.0]
[gw5] Python 3.11.0 (main, Jan 16 2023, 14:19:54) [GCC 11.2.0]
[gw7] Python 3.11.0 (main, Jan 16 2023, 14:19:54) [GCC 11.2.0]
[gw6] Python 3.11.0 (main, Jan 16 2023, 14:19:54) [GCC 11.2.0]
gw0 [191] / gw1 [191] / gw2 [191] / gw3 [191] / gw4 [191] / gw5 [191] / gw6 [191] / gw7 [191]

scheduling tests via LoadScheduling

tests/integration/test_00_support.py::TestSupport::test_clear_js_errors[chromium] 
tests/integration/test_02_display.py::TestOutput::test_display_HTML[chromium] 
tests/integration/test_py_config.py::TestConfig::test_multiple_py_config[chromium] 
tests/integration/test_splashscreen.py::TestSplashscreen::test_autoclose_loader_deprecated[chromium] 
tests/integration/test_interpreter.py::TestInterpreterAccess::test_backward_compatibility_runtime_python_access[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_repl_stderr_id_errors[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_bokeh_interactive[chromium] 
tests/integration/test_stdio_handling.py::TestOutputHandling::test_stdio_output_attribute_change[chromium] 
[gw6] [  0%] PASSED tests/integration/test_00_support.py::TestSupport::test_clear_js_errors[chromium] 
tests/integration/test_03_element.py::TestElement::test_element_id[chromium] 
[gw3] [  1%] PASSED tests/integration/test_py_config.py::TestConfig::test_multiple_py_config[chromium] 
tests/integration/test_interpreter.py::TestInterpreterAccess::test_interpreter_script_execution[chromium] 
[gw6] [  1%] PASSED tests/integration/test_03_element.py::TestElement::test_element_id[chromium] 
tests/integration/test_02_display.py::TestOutput::test_implicit_target_from_a_different_tag[chromium] 
[gw5] [  2%] PASSED tests/integration/test_interpreter.py::TestInterpreterAccess::test_backward_compatibility_runtime_python_access[chromium] 
tests/integration/test_01_basic.py::TestBasic::test_non_existent_package[chromium] 
[gw0] [  2%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_repl_stderr_id_errors[chromium] 
tests/integration/test_02_display.py::TestOutput::test_append_true[chromium] 
[gw1] [  3%] PASSED tests/integration/test_splashscreen.py::TestSplashscreen::test_autoclose_loader_deprecated[chromium] 
tests/integration/test_00_support.py::TestSupport::test_wait_for_console_simple[chromium] 
[gw4] [  3%] PASSED tests/integration/test_stdio_handling.py::TestOutputHandling::test_stdio_output_attribute_change[chromium] 
tests/integration/test_stdio_handling.py::TestOutputHandling::test_targeted_stdio_dynamic_tags[chromium] 
[gw7] [  4%] PASSED tests/integration/test_02_display.py::TestOutput::test_display_HTML[chromium] 
tests/integration/test_01_basic.py::TestBasic::test_js_version[chromium] 
[gw1] [  4%] PASSED tests/integration/test_00_support.py::TestSupport::test_wait_for_console_simple[chromium] 
tests/integration/test_02_display.py::TestOutput::test_explicit_different_target_from_call[chromium] 
[gw6] [  5%] PASSED tests/integration/test_02_display.py::TestOutput::test_implicit_target_from_a_different_tag[chromium] 
tests/integration/test_01_basic.py::TestBasic::test_py_mount_shows_deprecation_warning[chromium] 
[gw5] [  5%] PASSED tests/integration/test_01_basic.py::TestBasic::test_non_existent_package[chromium] 
[gw3] [  6%] PASSED tests/integration/test_interpreter.py::TestInterpreterAccess::test_interpreter_script_execution[chromium] 
tests/integration/test_py_config.py::TestConfig::test_invalid_toml_config[chromium] 
tests/integration/test_03_element.py::TestElement::test_element_value[chromium] 
[gw0] [  6%] PASSED tests/integration/test_02_display.py::TestOutput::test_append_true[chromium] 
tests/integration/test_03_element.py::TestElement::test_element_remove_single_class[chromium] 
[gw5] [  7%] PASSED tests/integration/test_py_config.py::TestConfig::test_invalid_toml_config[chromium] 
tests/integration/test_00_support.py::TestSupport::test_console[chromium] 
[gw4] [  7%] PASSED tests/integration/test_stdio_handling.py::TestOutputHandling::test_targeted_stdio_dynamic_tags[chromium] 
[gw5] [  8%] PASSED tests/integration/test_00_support.py::TestSupport::test_console[chromium] 
tests/integration/test_zzz_docs_snippets.py::TestDocsSnippets::test_tutorials_writing_to_page[chromium] 
tests/integration/test_plugins.py::TestPlugin::test_py_plugin_inline[chromium] 
[gw7] [  8%] PASSED tests/integration/test_01_basic.py::TestBasic::test_js_version[chromium] 
tests/integration/test_01_basic.py::TestBasic::test_python_version[chromium] 
[gw1] [  9%] PASSED tests/integration/test_02_display.py::TestOutput::test_explicit_different_target_from_call[chromium] 
tests/integration/test_py_config.py::TestConfig::test_multiple_interpreter[chromium] 
[gw2] [  9%] PASSED tests/integration/test_zz_examples.py::TestExamples::test_bokeh_interactive[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_folium[chromium] 
[gw0] [ 10%] PASSED tests/integration/test_03_element.py::TestElement::test_element_remove_single_class[chromium] 
tests/integration/test_01_basic.py::TestBasic::test_packages[chromium] 
[gw6] [ 10%] PASSED tests/integration/test_01_basic.py::TestBasic::test_py_mount_shows_deprecation_warning[chromium] 
[gw3] [ 11%] PASSED tests/integration/test_03_element.py::TestElement::test_element_value[chromium] 
tests/integration/test_00_support.py::TestSupport::test_wait_for_console_exception_1[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_matplotlib[chromium] 
[gw6] [ 12%] PASSED tests/integration/test_00_support.py::TestSupport::test_wait_for_console_exception_1[chromium] 
tests/integration/test_plugins.py::TestPlugin::test_fetch_plugin_no_file_extension[chromium] 
[gw5] [ 12%] PASSED tests/integration/test_plugins.py::TestPlugin::test_py_plugin_inline[chromium] 
[gw7] [ 13%] PASSED tests/integration/test_01_basic.py::TestBasic::test_python_version[chromium] 
[gw1] [ 13%] PASSED tests/integration/test_py_config.py::TestConfig::test_multiple_interpreter[chromium] 
tests/integration/test_01_basic.py::TestBasic::test_dynamically_add_py_script_tag[chromium] 
tests/integration/test_02_display.py::TestOutput::test_no_implicit_target[chromium] 
tests/integration/test_plugins.py::TestPlugin::test_fetch_python_plugin[chromium] 
[gw4] [ 14%] PASSED tests/integration/test_zzz_docs_snippets.py::TestDocsSnippets::test_tutorials_writing_to_page[chromium] 
tests/integration/test_03_element.py::TestElement::test_element_clone_to_other_element[chromium] 
[gw0] [ 14%] PASSED tests/integration/test_01_basic.py::TestBasic::test_packages[chromium] 
tests/integration/test_py_terminal.py::TestPyTerminal::test_two_terminals[chromium] 
[gw7] [ 15%] PASSED tests/integration/test_02_display.py::TestOutput::test_no_implicit_target[chromium] 
tests/integration/test_async.py::TestAsync::test_asyncio_create_task[chromium] 
[gw6] [ 15%] PASSED tests/integration/test_plugins.py::TestPlugin::test_fetch_plugin_no_file_extension[chromium] 
tests/integration/test_03_element.py::TestElement::test_element_add_multiple_class[chromium] 
[gw4] [ 16%] PASSED tests/integration/test_03_element.py::TestElement::test_element_clone_to_other_element[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_toga_freedom[chromium] 
[gw5] [ 16%] PASSED tests/integration/test_01_basic.py::TestBasic::test_dynamically_add_py_script_tag[chromium] 
tests/integration/test_00_support.py::TestSupport::test_wait_for_console_dont_wait_if_already_emitted[chromium] 
[gw5] [ 17%] PASSED tests/integration/test_00_support.py::TestSupport::test_wait_for_console_dont_wait_if_already_emitted[chromium] 
tests/integration/test_zzz_docs_snippets.py::TestDocsSnippets::test_tutorials_py_config_fetch[chromium] 
[gw1] [ 17%] PASSED tests/integration/test_plugins.py::TestPlugin::test_fetch_python_plugin[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_execute_code_typed_by_the_user[chromium] 
[gw2] [ 18%] FAILED tests/integration/test_zz_examples.py::TestExamples::test_folium[chromium] 
______________________ TestExamples.test_folium[chromium] ______________________
[gw2] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

self = <integration.test_zz_examples.TestExamples object at 0x7f46654983d0>

    def test_folium(self):
        self.goto("examples/folium.html")
>       self.wait_for_pyscript(timeout=60 * 1000)

tests/integration/test_zz_examples.py:139: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/integration/support.py:274: in wait_for_pyscript
    elapsed_ms = self.wait_for_console(
tests/integration/support.py:253: in wait_for_console
    self.page.wait_for_timeout(50)
env/lib/python3.11/site-packages/playwright/sync_api/_generated.py:11734: in wait_for_timeout
    self._sync(self._impl_obj.wait_for_timeout(timeout=timeout))
env/lib/python3.11/site-packages/playwright/_impl/_page.py:948: in wait_for_timeout
    await self._main_frame.wait_for_timeout(timeout)
env/lib/python3.11/site-packages/playwright/_impl/_frame.py:748: in wait_for_timeout
    await self._channel.send("waitForTimeout", locals_to_params(locals()))
env/lib/python3.11/site-packages/playwright/_impl/_connection.py:61: in send
    return await self._connection.wrap_api_call(
env/lib/python3.11/site-packages/playwright/_impl/_connection.py:461: in wrap_api_call
    return await cb()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <playwright._impl._connection.Channel object at 0x7f4664a29010>
method = 'waitForTimeout', params = {'timeout': 50}, return_as_dict = False

    async def inner_send(
        self, method: str, params: Optional[Dict], return_as_dict: bool
    ) -> Any:
        if params is None:
            params = {}
        callback = self._connection._send_message_to_server(self._guid, method, params)
        if self._connection._error:
            error = self._connection._error
            self._connection._error = None
            raise error
        done, _ = await asyncio.wait(
            {
                self._connection._transport.on_error_future,
                callback.future,
            },
            return_when=asyncio.FIRST_COMPLETED,
        )
        if not callback.future.done():
            callback.future.cancel()
>       result = next(iter(done)).result()
E       Exception: Connection closed while reading from the driver

env/lib/python3.11/site-packages/playwright/_impl/_connection.py:96: Exception
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] examples/folium.html[00m
[34;01m[  0.01 request          ] 200 - fake_server - http://fake_server/examples/folium.html[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[34;01m[  0.06 request          ] 200 - fake_server - http://fake_server/examples/assets/css/examples.css[00m
[34;01m[  0.07 request          ] 200 - fake_server - http://fake_server/examples/logo.png[00m
[  0.20 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  0.20 console.info     ] [36m[py-config][00m loading <py-config> content
[  0.20 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "type": "app",
  "schema_version": 1,
  "runtimes": [],
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "packages": [
    "folium",
    "pandas"
  ],
  "fetch": [],
  "plugins": [
    "../build/plugins/python/py_tutor.py"
  ],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T16:59:29.956Z"
  }
}
[  0.20 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  0.20 console.info     ] [36m[py-terminal][00m No <py-terminal> found, adding one
[  0.20 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  0.21 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...
[34;01m[  0.22 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js[00m
[  0.23 console.info     ] [36m[pyscript/main][00m Python startup...
[34;01m[  0.25 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_stdlib.zip[00m
[34;01m[  0.33 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.js[00m
[34;01m[  1.12 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/repodata.json[00m
[34;01m[  1.23 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.wasm[00m
[  4.66 console.info     ] [36m[pyscript/pyodide][00m importing pyscript
[  4.72 console.info     ] [36m[pyscript/pyodide][00m Found packages in configuration to install. Loading micropip...
[  4.72 console.info     ] [36m[pyscript/pyodide][00m pyodide.loadPackage: micropip
[  4.72 console.info     ] [36m[pyscript/pyodide][00m Loading micropip, packaging, pyparsing
[34;01m[  4.73 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/micropip-0.3.0-py3-none-any.whl[00m
[34;01m[  4.73 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/packaging-23.0-py3-none-any.whl[00m
[34;01m[  4.74 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyparsing-3.0.9-py3-none-any.whl[00m
[  4.82 console.info     ] [36m[pyscript/pyodide][00m Loaded pyparsing, packaging, micropip
[  4.93 console.info     ] [36m[pyscript/pyodide][00m pyodide loaded and initialized
[  4.93 console.log      ] Python initialization complete
[  4.94 console.info     ] [36m[pyscript/main][00m Python ready!
[  4.94 console.info     ] [36m[pyscript/main][00m Setting up virtual environment...
[  5.39 console.info     ] [36m[pyscript/main][00m Packages to install:  [folium, pandas]
[  5.39 console.info     ] [36m[pyscript/main][00m Fetching urls: 
[  5.40 console.info     ] [36m[pyscript/main][00m Fetched all paths
[  5.40 console.info     ] [36m[pyscript/pyodide][00m micropip install folium,pandas
[34;01m[  5.74 request          ] 200 - NETWORK - https://pypi.org/pypi/folium/json[00m
[34;01m[  6.29 request          ] 200 - NETWORK - https://files.pythonhosted.org/packages/0e/0f/22068577bc5eafdcbf5521dbaed6a5317a434ad6847ad3711dee1fd1f6ba/folium-0.14.0-py2.py3-none-any.whl[00m
[34;01m[  6.55 request          ] 200 - NETWORK - https://pypi.org/pypi/requests/json[00m
[34;01m[  6.64 request          ] 200 - NETWORK - https://pypi.org/pypi/branca/json[00m
[34;01m[  6.94 request          ] 200 - NETWORK - https://files.pythonhosted.org/packages/a6/18/cea6374623d82efc292996997cee0a13ae99359c7e66db22f92dc8484dd1/branca-0.6.0-py3-none-any.whl[00m
[34;01m[  7.15 request          ] 200 - NETWORK - https://files.pythonhosted.org/packages/d2/f4/274d1dbe96b41cf4e0efb70cbced278ffd61b5c7bb70338b62af94ccb25b/requests-2.28.2-py3-none-any.whl[00m
[34;01m[  7.35 request          ] 200 - NETWORK - https://pypi.org/pypi/urllib3/json[00m
[34;01m[  7.39 request          ] 200 - NETWORK - https://pypi.org/pypi/charset-normalizer/json[00m
[34;01m[  7.79 request          ] 200 - NETWORK - https://files.pythonhosted.org/packages/ef/81/14b3b8f01ddaddad6cdec97f2f599aa2fa466bd5ee9af99b08b7713ccd29/charset_normalizer-3.1.0-py3-none-any.whl[00m
[34;01m[  7.91 request          ] 200 - NETWORK - https://files.pythonhosted.org/packages/7b/f5/890a0baca17a61c1f92f72b81d3c31523c99bec609e60c292ea55b387ae8/urllib3-1.26.15-py2.py3-none-any.whl[00m
[  7.97 console.log      ] Loading pandas, numpy, python-dateutil, six, pytz, jinja2, markupsafe, certifi, idna
[34;01m[  8.16 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/numpy-1.24.2-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  8.29 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/Jinja2-3.1.2-py3-none-any.whl[00m
[34;01m[  8.29 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/MarkupSafe-2.1.2-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[ 13.42 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pandas-1.5.3-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
***** Error inside Fake_Server.router *****
Traceback (most recent call last):
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 732, in router
    return self._router(route)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 769, in _router
    resp = self.fetch_from_network(route.request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 810, in fetch_from_network
    body=api_response.body(),
         ^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/sync_api/_generated.py", line 17959, in body
    return mapping.from_maybe_impl(self._sync(self._impl_obj.body()))
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_sync_base.py", line 104, in _sync
    return task.result()
           ^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_fetch.py", line 444, in body
    result = await self._request._channel.send_return_as_dict(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 66, in send_return_as_dict
    return await self._connection.wrap_api_call(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 461, in wrap_api_call
    return await cb()
           ^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 96, in inner_send
    result = next(iter(done)).result()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
Exception: Connection closed while reading from the driver

***** Error inside Fake_Server.router *****
Traceback (most recent call last):
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 732, in router
    return self._router(route)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 769, in _router
    resp = self.fetch_from_network(route.request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 810, in fetch_from_network
    body=api_response.body(),
         ^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/sync_api/_generated.py", line 17959, in body
    return mapping.from_maybe_impl(self._sync(self._impl_obj.body()))
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_sync_base.py", line 104, in _sync
    return task.result()
           ^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_fetch.py", line 444, in body
    result = await self._request._channel.send_return_as_dict(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 66, in send_return_as_dict
    return await self._connection.wrap_api_call(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 461, in wrap_api_call
    return await cb()
           ^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 96, in inner_send
    result = next(iter(done)).result()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
Exception: Connection closed while reading from the driver

***** Error inside Fake_Server.router *****
Traceback (most recent call last):
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 732, in router
    return self._router(route)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 769, in _router
    resp = self.fetch_from_network(route.request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 810, in fetch_from_network
    body=api_response.body(),
         ^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/sync_api/_generated.py", line 17959, in body
    return mapping.from_maybe_impl(self._sync(self._impl_obj.body()))
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_sync_base.py", line 104, in _sync
    return task.result()
           ^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_fetch.py", line 444, in body
    result = await self._request._channel.send_return_as_dict(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 66, in send_return_as_dict
    return await self._connection.wrap_api_call(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 461, in wrap_api_call
    return await cb()
           ^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 96, in inner_send
    result = next(iter(done)).result()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
Exception: Connection closed while reading from the driver

----------------------------- Captured stderr call -----------------------------
Killed
[gw1] [ 18%] FAILED tests/integration/test_py_repl.py::TestPyRepl::test_execute_code_typed_by_the_user[chromium] 
___________ TestPyRepl.test_execute_code_typed_by_the_user[chromium] ___________
[gw1] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

self = <integration.test_py_repl.TestPyRepl object at 0x7f203931ea10>

    def test_execute_code_typed_by_the_user(self):
>       self.pyscript_run(
            """
            <py-repl></py-repl>
            """
        )

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/test_py_repl.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:320: in pyscript_run
    self.wait_for_pyscript(timeout=timeout)
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:274: in wait_for_pyscript
    elapsed_ms = self.wait_for_console(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <integration.test_py_repl.TestPyRepl object at 0x7f203931ea10>
text = '[pyscript/main] PyScript page fully initialized'

    def wait_for_console(self, text, *, timeout=None, check_js_errors=True):
        """
        Wait until the given message appear in the console. If the message was
        already printed in the console, return immediately.
    
        Note: it must be the *exact* string as printed by e.g. console.log.
    
        timeout is expressed in milliseconds. If it's None, it will use
        the same default as playwright, which is 30 seconds.
    
        If check_js_errors is True (the default), it also checks that no JS
        errors were raised during the waiting.
    
        Return the elapsed time in ms.
        """
        if timeout is None:
            timeout = 30 * 1000
        # NOTE: we cannot use playwright's own page.expect_console_message(),
        # because if you call it AFTER the text has already been emitted, it
        # waits forever. Instead, we have to use our own custom logic.
        try:
            t0 = time.time()
            while True:
                elapsed_ms = (time.time() - t0) * 1000
                if elapsed_ms > timeout:
>                   raise TimeoutError(f"{elapsed_ms:.2f} ms")
E                   TimeoutError: 30050.61 ms

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:247: TimeoutError
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] execute_code_typed_by_the_user.html[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/execute_code_typed_by_the_user.html[00m
[34;01m[  0.06 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.06 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[  0.36 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  0.36 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "schema_version": 1,
  "type": "app",
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "runtimes": [],
  "packages": [],
  "fetch": [],
  "plugins": [],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T16:59:40.932Z"
  }
}
[  0.36 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  0.38 console.info     ] [36m[py-terminal][00m No <py-terminal> found, adding one
[  0.38 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  0.38 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...
[34;01m[  0.41 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js[00m
[  0.44 console.info     ] [36m[pyscript/main][00m Python startup...
[34;01m[  0.51 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_stdlib.zip[00m
[34;01m[  0.70 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.js[00m
[34;01m[  2.02 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/repodata.json[00m
[34;01m[  2.21 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.wasm[00m

tests/integration/test_02_display.py::TestOutput::test_image_renders_correctly[chromium] 
[gw7] [ 19%] FAILED tests/integration/test_async.py::TestAsync::test_asyncio_create_task[chromium] 
_________________ TestAsync.test_asyncio_create_task[chromium] _________________
[gw7] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

self = <integration.test_async.TestAsync object at 0x7f0cc9384090>

    def test_asyncio_create_task(self):
>       self.pyscript_run(self.coroutine_script.format(func="create_task"))

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/test_async.py:27: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:320: in pyscript_run
    self.wait_for_pyscript(timeout=timeout)
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:274: in wait_for_pyscript
    elapsed_ms = self.wait_for_console(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <integration.test_async.TestAsync object at 0x7f0cc9384090>
text = '[pyscript/main] PyScript page fully initialized'

    def wait_for_console(self, text, *, timeout=None, check_js_errors=True):
        """
        Wait until the given message appear in the console. If the message was
        already printed in the console, return immediately.
    
        Note: it must be the *exact* string as printed by e.g. console.log.
    
        timeout is expressed in milliseconds. If it's None, it will use
        the same default as playwright, which is 30 seconds.
    
        If check_js_errors is True (the default), it also checks that no JS
        errors were raised during the waiting.
    
        Return the elapsed time in ms.
        """
        if timeout is None:
            timeout = 30 * 1000
        # NOTE: we cannot use playwright's own page.expect_console_message(),
        # because if you call it AFTER the text has already been emitted, it
        # waits forever. Instead, we have to use our own custom logic.
        try:
            t0 = time.time()
            while True:
                elapsed_ms = (time.time() - t0) * 1000
                if elapsed_ms > timeout:
>                   raise TimeoutError(f"{elapsed_ms:.2f} ms")
E                   TimeoutError: 30359.92 ms

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:247: TimeoutError
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] asyncio_create_task.html[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/asyncio_create_task.html[00m
[34;01m[  0.04 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.05 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[  0.30 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  0.30 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "schema_version": 1,
  "type": "app",
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "runtimes": [],
  "packages": [],
  "fetch": [],
  "plugins": [],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T16:59:39.987Z"
  }
}
[  0.31 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  0.32 console.info     ] [36m[py-terminal][00m No <py-terminal> found, adding one
[  0.32 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  0.32 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...
[34;01m[  0.36 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js[00m
[  0.39 console.info     ] [36m[pyscript/main][00m Python startup...
[34;01m[  0.43 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_stdlib.zip[00m
[34;01m[  0.54 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.js[00m
[34;01m[  2.07 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/repodata.json[00m
[34;01m[  2.29 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.wasm[00m

tests/integration/test_00_support.py::TestSupport::test_check_js_errors_expected_but_didnt_raise[chromium] 
[gw0] [ 19%] FAILED tests/integration/test_py_terminal.py::TestPyTerminal::test_two_terminals[chromium] 
_________________ TestPyTerminal.test_two_terminals[chromium] __________________
[gw0] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

self = <integration.test_py_terminal.TestPyTerminal object at 0x7f83982b9fd0>

    def test_two_terminals(self):
        """
        Multiple <py-terminal>s can cohexist.
        A <py-terminal> receives only output from the moment it is added to
        the DOM.
        """
>       self.pyscript_run(
            """
            <py-terminal id="term1"></py-terminal>
    
            <py-script>
                import js
                print('one')
                term2 = js.document.createElement('py-terminal')
                term2.id = 'term2'
                js.document.body.append(term2)
    
                print('two')
                print('three')
            </py-script>
            """
        )

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/test_py_terminal.py:47: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:320: in pyscript_run
    self.wait_for_pyscript(timeout=timeout)
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:274: in wait_for_pyscript
    elapsed_ms = self.wait_for_console(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <integration.test_py_terminal.TestPyTerminal object at 0x7f83982b9fd0>
text = '[pyscript/main] PyScript page fully initialized'

    def wait_for_console(self, text, *, timeout=None, check_js_errors=True):
        """
        Wait until the given message appear in the console. If the message was
        already printed in the console, return immediately.
    
        Note: it must be the *exact* string as printed by e.g. console.log.
    
        timeout is expressed in milliseconds. If it's None, it will use
        the same default as playwright, which is 30 seconds.
    
        If check_js_errors is True (the default), it also checks that no JS
        errors were raised during the waiting.
    
        Return the elapsed time in ms.
        """
        if timeout is None:
            timeout = 30 * 1000
        # NOTE: we cannot use playwright's own page.expect_console_message(),
        # because if you call it AFTER the text has already been emitted, it
        # waits forever. Instead, we have to use our own custom logic.
        try:
            t0 = time.time()
            while True:
                elapsed_ms = (time.time() - t0) * 1000
                if elapsed_ms > timeout:
>                   raise TimeoutError(f"{elapsed_ms:.2f} ms")
E                   TimeoutError: 30826.49 ms

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:247: TimeoutError
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] two_terminals.html[00m
[34;01m[  0.01 request          ] 200 - fake_server - http://fake_server/two_terminals.html[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.04 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[  0.21 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  0.21 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "schema_version": 1,
  "type": "app",
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "runtimes": [],
  "packages": [],
  "fetch": [],
  "plugins": [],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T16:59:39.536Z"
  }
}
[  0.21 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  0.21 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  0.21 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...
[34;01m[  0.22 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js[00m
[  0.23 console.info     ] [36m[pyscript/main][00m Python startup...
[34;01m[  0.27 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_stdlib.zip[00m
[34;01m[  0.36 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.js[00m
[34;01m[  1.68 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/repodata.json[00m
[34;01m[  1.91 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.wasm[00m

tests/integration/test_02_display.py::TestOutput::test_explicit_target_on_button_tag[chromium] 
[gw5] [ 20%] FAILED tests/integration/test_zzz_docs_snippets.py::TestDocsSnippets::test_tutorials_py_config_fetch[chromium] 
__________ TestDocsSnippets.test_tutorials_py_config_fetch[chromium] ___________
[gw5] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

self = <integration.test_zzz_docs_snippets.TestDocsSnippets object at 0x7f97f5460b10>

    def test_tutorials_py_config_fetch(self):
        # flake8: noqa
>       self.pyscript_run(
            """
                <py-config>
                [[fetch]]
                from = "https://pyscript.net/examples/"
                files = ["utils.py"]
                [[fetch]]
                from = "https://gist.githubusercontent.com/FabioRosado/faba0b7f6ad4438b07c9ac567c73b864/raw/37603b76dc7ef7997bf36781ea0116150f727f44/"
                files = ["todo.py"]
                </py-config>
                <py-script>
                    from todo import add_task, add_task_event
                </py-script>
                <section>
                <div class="text-center w-full mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 uppercase tracking-tight">
                        To Do List
                    </h1>
                </div>
                <div>
                    <input id="new-task-content" class="py-input" type="text">
                    <button id="new-task-btn" class="py-button" type="submit" py-click="add_task()">
                    Add task
                    </button>
                </div>
                <div id="list-tasks-container" class="flex flex-col-reverse mt-4"></div>
                <template id="task-template">
                    <section class="task py-li-element">
                    <label for="flex items-center p-2 ">
                        <input class="mr-2" type="checkbox">
                        <p class="m-0 inline"></p>
                    </label>
                    </section>
                </template
            """
        )

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/test_zzz_docs_snippets.py:72: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:320: in pyscript_run
    self.wait_for_pyscript(timeout=timeout)
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:274: in wait_for_pyscript
    elapsed_ms = self.wait_for_console(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <integration.test_zzz_docs_snippets.TestDocsSnippets object at 0x7f97f5460b10>
text = '[pyscript/main] PyScript page fully initialized'

    def wait_for_console(self, text, *, timeout=None, check_js_errors=True):
        """
        Wait until the given message appear in the console. If the message was
        already printed in the console, return immediately.
    
        Note: it must be the *exact* string as printed by e.g. console.log.
    
        timeout is expressed in milliseconds. If it's None, it will use
        the same default as playwright, which is 30 seconds.
    
        If check_js_errors is True (the default), it also checks that no JS
        errors were raised during the waiting.
    
        Return the elapsed time in ms.
        """
        if timeout is None:
            timeout = 30 * 1000
        # NOTE: we cannot use playwright's own page.expect_console_message(),
        # because if you call it AFTER the text has already been emitted, it
        # waits forever. Instead, we have to use our own custom logic.
        try:
            t0 = time.time()
            while True:
                elapsed_ms = (time.time() - t0) * 1000
                if elapsed_ms > timeout:
>                   raise TimeoutError(f"{elapsed_ms:.2f} ms")
E                   TimeoutError: 30381.78 ms

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:247: TimeoutError
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] tutorials_py_config_fetch.html[00m
[34;01m[  0.02 request          ] 200 - fake_server - http://fake_server/tutorials_py_config_fetch.html[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.04 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[  0.26 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  0.26 console.info     ] [36m[py-config][00m loading <py-config> content
[  0.27 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "type": "app",
  "schema_version": 1,
  "runtimes": [],
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "packages": [],
  "fetch": [
    {
      "from": "https://pyscript.net/examples/",
      "files": [
        "utils.py"
      ]
    },
    {
      "from": "https://gist.githubusercontent.com/FabioRosado/faba0b7f6ad4438b07c9ac567c73b864/raw/37603b76dc7ef7997bf36781ea0116150f727f44/",
      "files": [
        "todo.py"
      ]
    }
  ],
  "plugins": [],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T16:59:40.382Z"
  }
}
[  0.27 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  0.28 console.info     ] [36m[py-terminal][00m No <py-terminal> found, adding one
[  0.28 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  0.28 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...
[34;01m[  0.32 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js[00m
[  0.34 console.info     ] [36m[pyscript/main][00m Python startup...
[34;01m[  0.39 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_stdlib.zip[00m
[34;01m[  0.52 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.js[00m
[34;01m[  2.03 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/repodata.json[00m
[34;01m[  2.25 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.wasm[00m

tests/integration/test_splashscreen.py::TestSplashscreen::test_splashscreen_disabled_option[chromium] 
[gw4] [ 20%] XFAIL tests/integration/test_zz_examples.py::TestExamples::test_toga_freedom[chromium] 
tests/integration/test_py_config.py::TestConfig::test_no_interpreter[chromium] 
[gw6] [ 21%] FAILED tests/integration/test_03_element.py::TestElement::test_element_add_multiple_class[chromium] 
____________ TestElement.test_element_add_multiple_class[chromium] _____________
[gw6] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

self = <integration.test_03_element.TestElement object at 0x7fee248b6ad0>

    def test_element_add_multiple_class(self):
        """Test the element add_class"""
>       self.pyscript_run(
            """
            <style> .red { color: red; } .bold { font-weight: bold; } </style>
            <div id="foo">Hi!</div>
            <py-script>
                from pyscript import Element
                el = Element("foo")
                el.add_class(["red", "bold"])
            </py-script>
            """
        )

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/test_03_element.py:283: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:320: in pyscript_run
    self.wait_for_pyscript(timeout=timeout)
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:274: in wait_for_pyscript
    elapsed_ms = self.wait_for_console(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <integration.test_03_element.TestElement object at 0x7fee248b6ad0>
text = '[pyscript/main] PyScript page fully initialized'

    def wait_for_console(self, text, *, timeout=None, check_js_errors=True):
        """
        Wait until the given message appear in the console. If the message was
        already printed in the console, return immediately.
    
        Note: it must be the *exact* string as printed by e.g. console.log.
    
        timeout is expressed in milliseconds. If it's None, it will use
        the same default as playwright, which is 30 seconds.
    
        If check_js_errors is True (the default), it also checks that no JS
        errors were raised during the waiting.
    
        Return the elapsed time in ms.
        """
        if timeout is None:
            timeout = 30 * 1000
        # NOTE: we cannot use playwright's own page.expect_console_message(),
        # because if you call it AFTER the text has already been emitted, it
        # waits forever. Instead, we have to use our own custom logic.
        try:
            t0 = time.time()
            while True:
                elapsed_ms = (time.time() - t0) * 1000
                if elapsed_ms > timeout:
>                   raise TimeoutError(f"{elapsed_ms:.2f} ms")
E                   TimeoutError: 30338.96 ms

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:247: TimeoutError
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] element_add_multiple_class.html[00m
[34;01m[  0.02 request          ] 200 - fake_server - http://fake_server/element_add_multiple_class.html[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.04 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[  0.22 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  0.22 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "schema_version": 1,
  "type": "app",
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "runtimes": [],
  "packages": [],
  "fetch": [],
  "plugins": [],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T16:59:40.009Z"
  }
}
[  0.22 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  0.23 console.info     ] [36m[py-terminal][00m No <py-terminal> found, adding one
[  0.23 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  0.23 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...
[34;01m[  0.26 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js[00m
[  0.27 console.info     ] [36m[pyscript/main][00m Python startup...
[34;01m[  0.31 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_stdlib.zip[00m
[34;01m[  0.42 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.js[00m
[34;01m[  1.59 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/repodata.json[00m
[34;01m[  1.81 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.wasm[00m

tests/integration/test_py_repl.py::TestPyRepl::test_repl_output_attribute_change[chromium] 
[gw2] [ 21%] ERROR tests/integration/test_zz_examples.py::TestExamples::test_folium[chromium] 
___________ ERROR at teardown of TestExamples.test_folium[chromium] ____________
[gw2] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

browser = <Browser type=<BrowserType name=chromium executable_path=/home/jglass/.cache/ms-playwright/chromium-1055/chrome-linux/chrome> version=112.0.5615.29>
browser_context_args = {}
pytestconfig = <_pytest.config.Config object at 0x7f467859b150>
request = <SubRequest 'context' for <Function test_folium[chromium]>>

    @pytest.fixture
    def context(
        browser: Browser,
        browser_context_args: Dict,
        pytestconfig: Any,
        request: pytest.FixtureRequest,
    ) -> Generator[BrowserContext, None, None]:
        pages: List[Page] = []
        context = browser.new_context(**browser_context_args)
        context.on("page", lambda page: pages.append(page))
    
        tracing_option = pytestconfig.getoption("--tracing")
        capture_trace = tracing_option in ["on", "retain-on-failure"]
        if capture_trace:
            context.tracing.start(
                name=slugify(request.node.nodeid),
                screenshots=True,
                snapshots=True,
                sources=True,
            )
    
        yield context
    
        # If requst.node is missing rep_call, then some error happened during execution
        # that prevented teardown, but should still be counted as a failure
        failed = request.node.rep_call.failed if hasattr(request.node, "rep_call") else True
    
        if capture_trace:
            retain_trace = tracing_option == "on" or (
                failed and tracing_option == "retain-on-failure"
            )
            if retain_trace:
                trace_path = _build_artifact_test_folder(pytestconfig, request, "trace.zip")
                context.tracing.stop(path=trace_path)
            else:
                context.tracing.stop()
    
        screenshot_option = pytestconfig.getoption("--screenshot")
        capture_screenshot = screenshot_option == "on" or (
            failed and screenshot_option == "only-on-failure"
        )
        if capture_screenshot:
            for index, page in enumerate(pages):
                human_readable_status = "failed" if failed else "finished"
                screenshot_path = _build_artifact_test_folder(
                    pytestconfig, request, f"test-{human_readable_status}-{index+1}.png"
                )
                try:
                    page.screenshot(timeout=5000, path=screenshot_path)
                except Error:
                    pass
    
>       context.close()

env/lib/python3.11/site-packages/pytest_playwright/pytest_playwright.py:263: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
env/lib/python3.11/site-packages/playwright/sync_api/_generated.py:13553: in close
    return mapping.from_maybe_impl(self._sync(self._impl_obj.close()))
env/lib/python3.11/site-packages/playwright/_impl/_browser_context.py:448: in close
    await self._channel.send("close")
env/lib/python3.11/site-packages/playwright/_impl/_connection.py:61: in send
    return await self._connection.wrap_api_call(
env/lib/python3.11/site-packages/playwright/_impl/_connection.py:461: in wrap_api_call
    return await cb()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <playwright._impl._connection.Channel object at 0x7f4664a23a50>
method = 'close', params = {}, return_as_dict = False

    async def inner_send(
        self, method: str, params: Optional[Dict], return_as_dict: bool
    ) -> Any:
        if params is None:
            params = {}
        callback = self._connection._send_message_to_server(self._guid, method, params)
        if self._connection._error:
            error = self._connection._error
            self._connection._error = None
            raise error
        done, _ = await asyncio.wait(
            {
                self._connection._transport.on_error_future,
                callback.future,
            },
            return_when=asyncio.FIRST_COMPLETED,
        )
        if not callback.future.done():
            callback.future.cancel()
>       result = next(iter(done)).result()
E       Exception: Connection closed while reading from the driver

env/lib/python3.11/site-packages/playwright/_impl/_connection.py:96: Exception
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] examples/folium.html[00m
[34;01m[  0.01 request          ] 200 - fake_server - http://fake_server/examples/folium.html[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[34;01m[  0.06 request          ] 200 - fake_server - http://fake_server/examples/assets/css/examples.css[00m
[34;01m[  0.07 request          ] 200 - fake_server - http://fake_server/examples/logo.png[00m
[  0.20 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  0.20 console.info     ] [36m[py-config][00m loading <py-config> content
[  0.20 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "type": "app",
  "schema_version": 1,
  "runtimes": [],
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "packages": [
    "folium",
    "pandas"
  ],
  "fetch": [],
  "plugins": [
    "../build/plugins/python/py_tutor.py"
  ],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T16:59:29.956Z"
  }
}
[  0.20 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  0.20 console.info     ] [36m[py-terminal][00m No <py-terminal> found, adding one
[  0.20 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  0.21 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...
[34;01m[  0.22 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js[00m
[  0.23 console.info     ] [36m[pyscript/main][00m Python startup...
[34;01m[  0.25 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_stdlib.zip[00m
[34;01m[  0.33 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.js[00m
[34;01m[  1.12 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/repodata.json[00m
[34;01m[  1.23 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.wasm[00m
[  4.66 console.info     ] [36m[pyscript/pyodide][00m importing pyscript
[  4.72 console.info     ] [36m[pyscript/pyodide][00m Found packages in configuration to install. Loading micropip...
[  4.72 console.info     ] [36m[pyscript/pyodide][00m pyodide.loadPackage: micropip
[  4.72 console.info     ] [36m[pyscript/pyodide][00m Loading micropip, packaging, pyparsing
[34;01m[  4.73 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/micropip-0.3.0-py3-none-any.whl[00m
[34;01m[  4.73 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/packaging-23.0-py3-none-any.whl[00m
[34;01m[  4.74 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyparsing-3.0.9-py3-none-any.whl[00m
[  4.82 console.info     ] [36m[pyscript/pyodide][00m Loaded pyparsing, packaging, micropip
[  4.93 console.info     ] [36m[pyscript/pyodide][00m pyodide loaded and initialized
[  4.93 console.log      ] Python initialization complete
[  4.94 console.info     ] [36m[pyscript/main][00m Python ready!
[  4.94 console.info     ] [36m[pyscript/main][00m Setting up virtual environment...
[  5.39 console.info     ] [36m[pyscript/main][00m Packages to install:  [folium, pandas]
[  5.39 console.info     ] [36m[pyscript/main][00m Fetching urls: 
[  5.40 console.info     ] [36m[pyscript/main][00m Fetched all paths
[  5.40 console.info     ] [36m[pyscript/pyodide][00m micropip install folium,pandas
[34;01m[  5.74 request          ] 200 - NETWORK - https://pypi.org/pypi/folium/json[00m
[34;01m[  6.29 request          ] 200 - NETWORK - https://files.pythonhosted.org/packages/0e/0f/22068577bc5eafdcbf5521dbaed6a5317a434ad6847ad3711dee1fd1f6ba/folium-0.14.0-py2.py3-none-any.whl[00m
[34;01m[  6.55 request          ] 200 - NETWORK - https://pypi.org/pypi/requests/json[00m
[34;01m[  6.64 request          ] 200 - NETWORK - https://pypi.org/pypi/branca/json[00m
[34;01m[  6.94 request          ] 200 - NETWORK - https://files.pythonhosted.org/packages/a6/18/cea6374623d82efc292996997cee0a13ae99359c7e66db22f92dc8484dd1/branca-0.6.0-py3-none-any.whl[00m
[34;01m[  7.15 request          ] 200 - NETWORK - https://files.pythonhosted.org/packages/d2/f4/274d1dbe96b41cf4e0efb70cbced278ffd61b5c7bb70338b62af94ccb25b/requests-2.28.2-py3-none-any.whl[00m
[34;01m[  7.35 request          ] 200 - NETWORK - https://pypi.org/pypi/urllib3/json[00m
[34;01m[  7.39 request          ] 200 - NETWORK - https://pypi.org/pypi/charset-normalizer/json[00m
[34;01m[  7.79 request          ] 200 - NETWORK - https://files.pythonhosted.org/packages/ef/81/14b3b8f01ddaddad6cdec97f2f599aa2fa466bd5ee9af99b08b7713ccd29/charset_normalizer-3.1.0-py3-none-any.whl[00m
[34;01m[  7.91 request          ] 200 - NETWORK - https://files.pythonhosted.org/packages/7b/f5/890a0baca17a61c1f92f72b81d3c31523c99bec609e60c292ea55b387ae8/urllib3-1.26.15-py2.py3-none-any.whl[00m
[  7.97 console.log      ] Loading pandas, numpy, python-dateutil, six, pytz, jinja2, markupsafe, certifi, idna
[34;01m[  8.16 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/numpy-1.24.2-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  8.29 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/Jinja2-3.1.2-py3-none-any.whl[00m
[34;01m[  8.29 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/MarkupSafe-2.1.2-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[ 13.42 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pandas-1.5.3-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
***** Error inside Fake_Server.router *****
Traceback (most recent call last):
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 732, in router
    return self._router(route)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 769, in _router
    resp = self.fetch_from_network(route.request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 810, in fetch_from_network
    body=api_response.body(),
         ^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/sync_api/_generated.py", line 17959, in body
    return mapping.from_maybe_impl(self._sync(self._impl_obj.body()))
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_sync_base.py", line 104, in _sync
    return task.result()
           ^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_fetch.py", line 444, in body
    result = await self._request._channel.send_return_as_dict(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 66, in send_return_as_dict
    return await self._connection.wrap_api_call(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 461, in wrap_api_call
    return await cb()
           ^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 96, in inner_send
    result = next(iter(done)).result()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
Exception: Connection closed while reading from the driver

***** Error inside Fake_Server.router *****
Traceback (most recent call last):
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 732, in router
    return self._router(route)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 769, in _router
    resp = self.fetch_from_network(route.request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 810, in fetch_from_network
    body=api_response.body(),
         ^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/sync_api/_generated.py", line 17959, in body
    return mapping.from_maybe_impl(self._sync(self._impl_obj.body()))
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_sync_base.py", line 104, in _sync
    return task.result()
           ^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_fetch.py", line 444, in body
    result = await self._request._channel.send_return_as_dict(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 66, in send_return_as_dict
    return await self._connection.wrap_api_call(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 461, in wrap_api_call
    return await cb()
           ^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 96, in inner_send
    result = next(iter(done)).result()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
Exception: Connection closed while reading from the driver

***** Error inside Fake_Server.router *****
Traceback (most recent call last):
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 732, in router
    return self._router(route)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 769, in _router
    resp = self.fetch_from_network(route.request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 810, in fetch_from_network
    body=api_response.body(),
         ^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/sync_api/_generated.py", line 17959, in body
    return mapping.from_maybe_impl(self._sync(self._impl_obj.body()))
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_sync_base.py", line 104, in _sync
    return task.result()
           ^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_fetch.py", line 444, in body
    result = await self._request._channel.send_return_as_dict(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 66, in send_return_as_dict
    return await self._connection.wrap_api_call(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 461, in wrap_api_call
    return await cb()
           ^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 96, in inner_send
    result = next(iter(done)).result()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
Exception: Connection closed while reading from the driver

----------------------------- Captured stderr call -----------------------------
Killed
--------------------------- Captured stdout teardown ---------------------------
***** Error inside Fake_Server.router *****
Traceback (most recent call last):
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 732, in router
    return self._router(route)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 769, in _router
    resp = self.fetch_from_network(route.request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 810, in fetch_from_network
    body=api_response.body(),
         ^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/sync_api/_generated.py", line 17959, in body
    return mapping.from_maybe_impl(self._sync(self._impl_obj.body()))
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_sync_base.py", line 104, in _sync
    return task.result()
           ^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_fetch.py", line 444, in body
    result = await self._request._channel.send_return_as_dict(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 66, in send_return_as_dict
    return await self._connection.wrap_api_call(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 461, in wrap_api_call
    return await cb()
           ^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 96, in inner_send
    result = next(iter(done)).result()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
Exception: Connection closed while reading from the driver

***** Error inside Fake_Server.router *****
Traceback (most recent call last):
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 732, in router
    return self._router(route)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 769, in _router
    resp = self.fetch_from_network(route.request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py", line 810, in fetch_from_network
    body=api_response.body(),
         ^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/sync_api/_generated.py", line 17959, in body
    return mapping.from_maybe_impl(self._sync(self._impl_obj.body()))
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_sync_base.py", line 104, in _sync
    return task.result()
           ^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_fetch.py", line 444, in body
    result = await self._request._channel.send_return_as_dict(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 66, in send_return_as_dict
    return await self._connection.wrap_api_call(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 461, in wrap_api_call
    return await cb()
           ^^^^^^^^^^
  File "/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py", line 96, in inner_send
    result = next(iter(done)).result()
             ^^^^^^^^^^^^^^^^^^^^^^^^^
Exception: Connection closed while reading from the driver

---------------------------- Captured log teardown -----------------------------
WARNING  asyncio:unix_events.py:678 pipe closed by peer or os.write(pipe, data) raised exception.

tests/integration/test_interpreter.py::TestInterpreterAccess::test_backward_compatibility_runtime_script_execution[chromium] 
[gw7] [ 21%] PASSED tests/integration/test_00_support.py::TestSupport::test_check_js_errors_expected_but_didnt_raise[chromium] 
tests/integration/test_splashscreen.py::TestSplashscreen::test_splashscreen_custom_message[chromium] 
[gw4] [ 22%] PASSED tests/integration/test_py_config.py::TestConfig::test_no_interpreter[chromium] 
tests/integration/test_async.py::TestAsync::test_multiple_async[chromium] 
[gw7] [ 23%] PASSED tests/integration/test_splashscreen.py::TestSplashscreen::test_splashscreen_custom_message[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_auto_generate[chromium] 
[gw0] [ 23%] PASSED tests/integration/test_02_display.py::TestOutput::test_explicit_target_on_button_tag[chromium] 
[gw5] [ 24%] PASSED tests/integration/test_splashscreen.py::TestSplashscreen::test_splashscreen_disabled_option[chromium] 
tests/integration/test_01_basic.py::TestBasic::test_escaping_of_angle_brackets[chromium] 
tests/integration/test_03_element.py::TestElement::test_element_write_append[chromium] 
[gw6] [ 24%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_repl_output_attribute_change[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_repl2[chromium] 
[gw4] [ 25%] PASSED tests/integration/test_async.py::TestAsync::test_multiple_async[chromium] 
tests/integration/test_plugins.py::TestPlugin::test_fetch_js_no_export[chromium] 
[gw1] [ 25%] PASSED tests/integration/test_02_display.py::TestOutput::test_image_renders_correctly[chromium] 
tests/integration/test_plugins.py::TestPlugin::test_no_plugin_attribute_error[chromium] 
[gw0] [ 26%] PASSED tests/integration/test_01_basic.py::TestBasic::test_escaping_of_angle_brackets[chromium] 
tests/integration/test_00_support.py::TestSupport::test_smartrouter_cache[chromium] 
[gw5] [ 26%] PASSED tests/integration/test_03_element.py::TestElement::test_element_write_append[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_markdown_plugin[chromium] 
[gw0] [ 27%] PASSED tests/integration/test_00_support.py::TestSupport::test_smartrouter_cache[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_altair[chromium] 
[gw7] [ 27%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_auto_generate[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_execute_preloaded_source[chromium] 
[gw1] [ 28%] PASSED tests/integration/test_plugins.py::TestPlugin::test_no_plugin_attribute_error[chromium] 
tests/integration/test_01_basic.py::TestBasic::test_python_exception[chromium] 
[gw4] [ 28%] PASSED tests/integration/test_plugins.py::TestPlugin::test_fetch_js_no_export[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_d3[chromium] 
[gw4] [ 29%] SKIPPED tests/integration/test_zz_examples.py::TestExamples::test_d3[chromium] 
tests/integration/test_01_basic.py::TestBasic::test_pys_onClick_shows_deprecation_warning[chromium] 
[gw4] [ 29%] SKIPPED tests/integration/test_01_basic.py::TestBasic::test_pys_onClick_shows_deprecation_warning[chromium] 
tests/integration/test_py_config.py::TestConfig::test_interpreter_config[chromium] 
[gw7] [ 30%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_execute_preloaded_source[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_execute_on_shift_enter[chromium] 
[gw1] [ 30%] PASSED tests/integration/test_01_basic.py::TestBasic::test_python_exception[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_repl_output_id_errors[chromium] 
[gw5] [ 31%] PASSED tests/integration/test_zz_examples.py::TestExamples::test_markdown_plugin[chromium] 
tests/integration/test_02_display.py::TestOutput::test_display_should_escape[chromium] 
[gw3] [ 31%] FAILED tests/integration/test_zz_examples.py::TestExamples::test_matplotlib[chromium] 
____________________ TestExamples.test_matplotlib[chromium] ____________________
[gw3] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

self = <integration.test_zz_examples.TestExamples object at 0x7fc1b1180dd0>

    def test_matplotlib(self):
        self.goto("examples/matplotlib.html")
>       self.wait_for_pyscript(timeout=60 * 1000)

tests/integration/test_zz_examples.py:175: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/integration/support.py:274: in wait_for_pyscript
    elapsed_ms = self.wait_for_console(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <integration.test_zz_examples.TestExamples object at 0x7fc1b1180dd0>
text = '[pyscript/main] PyScript page fully initialized'

    def wait_for_console(self, text, *, timeout=None, check_js_errors=True):
        """
        Wait until the given message appear in the console. If the message was
        already printed in the console, return immediately.
    
        Note: it must be the *exact* string as printed by e.g. console.log.
    
        timeout is expressed in milliseconds. If it's None, it will use
        the same default as playwright, which is 30 seconds.
    
        If check_js_errors is True (the default), it also checks that no JS
        errors were raised during the waiting.
    
        Return the elapsed time in ms.
        """
        if timeout is None:
            timeout = 30 * 1000
        # NOTE: we cannot use playwright's own page.expect_console_message(),
        # because if you call it AFTER the text has already been emitted, it
        # waits forever. Instead, we have to use our own custom logic.
        try:
            t0 = time.time()
            while True:
                elapsed_ms = (time.time() - t0) * 1000
                if elapsed_ms > timeout:
>                   raise TimeoutError(f"{elapsed_ms:.2f} ms")
E                   TimeoutError: 60040.71 ms

tests/integration/support.py:247: TimeoutError
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] examples/matplotlib.html[00m
[34;01m[  0.02 request          ] 200 - fake_server - http://fake_server/examples/matplotlib.html[00m
[34;01m[  0.05 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.05 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[34;01m[  0.06 request          ] 200 - fake_server - http://fake_server/examples/assets/css/examples.css[00m
[34;01m[  0.06 request          ] 200 - fake_server - http://fake_server/examples/logo.png[00m
[  0.24 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  0.24 console.info     ] [36m[py-config][00m loading <py-config> content
[  0.25 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "type": "app",
  "schema_version": 1,
  "runtimes": [],
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "packages": [
    "matplotlib"
  ],
  "fetch": [],
  "plugins": [
    "../build/plugins/python/py_tutor.py"
  ],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T16:59:32.494Z"
  }
}
[  0.25 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  0.25 console.info     ] [36m[py-terminal][00m No <py-terminal> found, adding one
[  0.25 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  0.25 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...
[34;01m[  0.27 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js[00m
[  0.28 console.info     ] [36m[pyscript/main][00m Python startup...
[34;01m[  0.32 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_stdlib.zip[00m
[34;01m[  0.42 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.js[00m
[34;01m[  1.22 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/repodata.json[00m
[34;01m[  1.39 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.wasm[00m
[  5.26 console.info     ] [36m[pyscript/pyodide][00m importing pyscript
[  5.31 console.info     ] [36m[pyscript/pyodide][00m Found packages in configuration to install. Loading micropip...
[  5.33 console.info     ] [36m[pyscript/pyodide][00m pyodide.loadPackage: micropip
[  5.33 console.info     ] [36m[pyscript/pyodide][00m Loading micropip, packaging, pyparsing
[34;01m[  5.33 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/micropip-0.3.0-py3-none-any.whl[00m
[34;01m[  5.33 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/packaging-23.0-py3-none-any.whl[00m
[34;01m[  5.34 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyparsing-3.0.9-py3-none-any.whl[00m
[  5.46 console.info     ] [36m[pyscript/pyodide][00m Loaded pyparsing, packaging, micropip
[  5.58 console.info     ] [36m[pyscript/pyodide][00m pyodide loaded and initialized
[  5.59 console.log      ] Python initialization complete
[  5.59 console.info     ] [36m[pyscript/main][00m Python ready!
[  5.59 console.info     ] [36m[pyscript/main][00m Setting up virtual environment...
[  5.91 console.info     ] [36m[pyscript/main][00m Packages to install:  [matplotlib]
[  5.91 console.info     ] [36m[pyscript/main][00m Fetching urls: 
[  5.91 console.info     ] [36m[pyscript/main][00m Fetched all paths
[  5.91 console.info     ] [36m[pyscript/pyodide][00m micropip install matplotlib
[  5.92 console.log      ] packaging already loaded from default channel
[  5.93 console.log      ] pyparsing already loaded from default channel
[  5.93 console.log      ] Loading matplotlib, cycler, six, fonttools, kiwisolver, numpy, pillow, python-dateutil, pytz, matplotlib-pyodide
[34;01m[  6.09 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/numpy-1.24.2-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  6.26 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/PIL-9.1.1-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  7.60 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/cycler-0.11.0-py3-none-any.whl[00m
[34;01m[  7.60 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/six-1.16.0-py2.py3-none-any.whl[00m
[34;01m[  7.61 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/kiwisolver-1.4.4-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  7.90 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/fonttools-4.39.3-py3-none-any.whl[00m
[34;01m[ 11.42 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/matplotlib-3.5.2-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[ 21.92 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/matplotlib_pyodide-0.1.1-py3-none-any.whl[00m
[34;01m[ 22.17 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_dateutil-2.8.2-py2.py3-none-any.whl[00m
[34;01m[ 22.81 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pytz-2023.3-py2.py3-none-any.whl[00m

tests/integration/test_02_display.py::TestOutput::test_text_HTML_and_console_output[chromium] 
[gw7] [ 32%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_execute_on_shift_enter[chromium] 
tests/integration/test_warnings_and_banners.py::TestWarningsAndBanners::test_create_singular_warning[chromium] 
[gw1] [ 32%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_repl_output_id_errors[chromium] 
tests/integration/test_01_basic.py::TestBasic::test_assert_no_banners[chromium] 
[gw5] [ 33%] PASSED tests/integration/test_02_display.py::TestOutput::test_display_should_escape[chromium] 
tests/integration/test_stdio_handling.py::TestOutputHandling::test_stdio_escape[chromium] 
[gw3] [ 34%] PASSED tests/integration/test_02_display.py::TestOutput::test_text_HTML_and_console_output[chromium] 
tests/integration/test_splashscreen.py::TestSplashscreen::test_autoshow_and_autoclose[chromium] 
[gw7] [ 34%] PASSED tests/integration/test_warnings_and_banners.py::TestWarningsAndBanners::test_create_singular_warning[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_repl_load_content_from_src[chromium] 
[gw1] [ 35%] PASSED tests/integration/test_01_basic.py::TestBasic::test_assert_no_banners[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_repl_loads[chromium] 
[gw5] [ 35%] PASSED tests/integration/test_stdio_handling.py::TestOutputHandling::test_stdio_escape[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_python_exception[chromium] 
[gw3] [ 36%] PASSED tests/integration/test_splashscreen.py::TestSplashscreen::test_autoshow_and_autoclose[chromium] 
tests/integration/test_02_display.py::TestOutput::test_console_line_break[chromium] 
[gw7] [ 36%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_repl_load_content_from_src[chromium] 
tests/integration/test_plugins.py::TestPlugin::test_fetch_js_plugin_non_existent[chromium] 
[gw1] [ 37%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_repl_loads[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_numpy_canvas_fractals[chromium] 
[gw5] [ 37%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_python_exception[chromium] 
tests/integration/test_03_element.py::TestElement::test_element_write_no_append[chromium] 
[gw0] [ 38%] PASSED tests/integration/test_zz_examples.py::TestExamples::test_altair[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_panel_deckgl[chromium] 
[gw3] [ 38%] PASSED tests/integration/test_02_display.py::TestOutput::test_console_line_break[chromium] 
tests/integration/test_py_config.py::TestConfig::test_py_config_inline[chromium] 
[gw7] [ 39%] PASSED tests/integration/test_plugins.py::TestPlugin::test_fetch_js_plugin_non_existent[chromium] 
tests/integration/test_02_display.py::TestOutput::test_display_multiple_values[chromium] 
[gw5] [ 39%] PASSED tests/integration/test_03_element.py::TestElement::test_element_write_no_append[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_repl_src_change[chromium] 
[gw3] [ 40%] PASSED tests/integration/test_py_config.py::TestConfig::test_py_config_inline[chromium] 
tests/integration/test_stdio_handling.py::TestOutputHandling::test_stdio_target_element_id_change[chromium] 
[gw6] [ 40%] FAILED tests/integration/test_zz_examples.py::TestExamples::test_repl2[chromium] 
______________________ TestExamples.test_repl2[chromium] _______________________
[gw6] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

self = <integration.test_zz_examples.TestExamples object at 0x7fee1ff7f850>

    def test_repl2(self):
        self.goto("examples/repl2.html")
>       self.wait_for_pyscript(timeout=1.5 * 60 * 1000)

tests/integration/test_zz_examples.py:320: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/integration/support.py:274: in wait_for_pyscript
    elapsed_ms = self.wait_for_console(
tests/integration/support.py:253: in wait_for_console
    self.page.wait_for_timeout(50)
env/lib/python3.11/site-packages/playwright/sync_api/_generated.py:11734: in wait_for_timeout
    self._sync(self._impl_obj.wait_for_timeout(timeout=timeout))
env/lib/python3.11/site-packages/playwright/_impl/_page.py:948: in wait_for_timeout
    await self._main_frame.wait_for_timeout(timeout)
env/lib/python3.11/site-packages/playwright/_impl/_frame.py:748: in wait_for_timeout
    await self._channel.send("waitForTimeout", locals_to_params(locals()))
env/lib/python3.11/site-packages/playwright/_impl/_connection.py:61: in send
    return await self._connection.wrap_api_call(
env/lib/python3.11/site-packages/playwright/_impl/_connection.py:461: in wrap_api_call
    return await cb()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <playwright._impl._connection.Channel object at 0x7fee12ce08d0>
method = 'waitForTimeout', params = {'timeout': 50}, return_as_dict = False

    async def inner_send(
        self, method: str, params: Optional[Dict], return_as_dict: bool
    ) -> Any:
        if params is None:
            params = {}
        callback = self._connection._send_message_to_server(self._guid, method, params)
        if self._connection._error:
            error = self._connection._error
            self._connection._error = None
            raise error
        done, _ = await asyncio.wait(
            {
                self._connection._transport.on_error_future,
                callback.future,
            },
            return_when=asyncio.FIRST_COMPLETED,
        )
        if not callback.future.done():
            callback.future.cancel()
>       result = next(iter(done)).result()
E       Exception: Connection closed while reading from the driver

env/lib/python3.11/site-packages/playwright/_impl/_connection.py:96: Exception
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] examples/repl2.html[00m
[34;01m[  0.01 request          ] 200 - fake_server - http://fake_server/examples/repl2.html[00m
[34;01m[  0.02 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/examples/repl.css[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/examples/assets/css/examples.css[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[34;01m[  0.04 request          ] 200 - fake_server - http://fake_server/examples/logo.png[00m
[  0.17 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  0.17 console.info     ] [36m[py-config][00m loading <py-config> content
[  0.17 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "type": "app",
  "schema_version": 1,
  "runtimes": [],
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "packages": [
    "bokeh",
    "numpy"
  ],
  "fetch": [
    {
      "files": [
        "./utils.py",
        "./antigravity.py"
      ]
    }
  ],
  "plugins": [
    "../build/plugins/python/py_tutor.py"
  ],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T17:00:17.483Z"
  }
}
[  0.17 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  0.17 console.info     ] [36m[py-terminal][00m No <py-terminal> found, adding one
[  0.17 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  0.17 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...
[34;01m[  0.18 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js[00m
[  0.19 console.info     ] [36m[pyscript/main][00m Python startup...
[34;01m[  0.22 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_stdlib.zip[00m
[34;01m[  0.28 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.js[00m
[34;01m[  1.57 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/repodata.json[00m
[34;01m[  1.83 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.wasm[00m
[  5.13 console.info     ] [36m[pyscript/pyodide][00m importing pyscript
[  5.18 console.info     ] [36m[pyscript/pyodide][00m Found packages in configuration to install. Loading micropip...
[  5.19 console.info     ] [36m[pyscript/pyodide][00m pyodide.loadPackage: micropip
[  5.19 console.info     ] [36m[pyscript/pyodide][00m Loading micropip, packaging, pyparsing
[34;01m[  5.19 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/micropip-0.3.0-py3-none-any.whl[00m
[34;01m[  5.19 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/packaging-23.0-py3-none-any.whl[00m
[34;01m[  5.20 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyparsing-3.0.9-py3-none-any.whl[00m
[  5.28 console.info     ] [36m[pyscript/pyodide][00m Loaded pyparsing, packaging, micropip
[  5.39 console.info     ] [36m[pyscript/pyodide][00m pyodide loaded and initialized
[  5.39 console.log      ] Python initialization complete
[  5.39 console.info     ] [36m[pyscript/main][00m Python ready!
[  5.39 console.info     ] [36m[pyscript/main][00m Setting up virtual environment...
[  5.62 console.info     ] [36m[pyscript/main][00m Packages to install:  [bokeh, numpy]
[  5.62 console.info     ] [36m[pyscript/main][00m Fetching urls: ./utils.py, ./antigravity.py
[  5.62 console.info     ] [36m[pyscript/pyodide][00m micropip install bokeh,numpy
[34;01m[  5.62 request          ] 200 - fake_server - http://fake_server/examples/utils.py[00m
[34;01m[  5.62 request          ] 200 - fake_server - http://fake_server/examples/antigravity.py[00m
[  5.64 console.log      ] Loading bokeh, distutils, numpy, jinja2, markupsafe, pillow, python-dateutil, six, typing-extensions, pyyaml
[34;01m[  5.76 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/numpy-1.24.2-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  5.84 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/Jinja2-3.1.2-py3-none-any.whl[00m
[34;01m[  5.85 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/MarkupSafe-2.1.2-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  5.89 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/PIL-9.1.1-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  5.91 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_dateutil-2.8.2-py2.py3-none-any.whl[00m
[34;01m[  5.92 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/six-1.16.0-py2.py3-none-any.whl[00m
[34;01m[  5.92 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/typing_extensions-4.5.0-py3-none-any.whl[00m
[34;01m[  5.93 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/PyYAML-6.0-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[  5.94 console.info     ] [36m[pyscript/main][00m     Fetched ./utils.py ==> ./utils.py
[  5.94 console.info     ] [36m[pyscript/main][00m     Fetched ./antigravity.py ==> ./antigravity.py
[  5.94 console.info     ] [36m[pyscript/main][00m Fetched all paths
[34;01m[  7.15 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/distutils-1.0.0.zip[00m
[34;01m[ 22.94 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/bokeh-3.1.0-py3-none-any.whl[00m
----------------------------- Captured stderr call -----------------------------
Killed
[gw6] [ 40%] ERROR tests/integration/test_zz_examples.py::TestExamples::test_repl2[chromium] 
____________ ERROR at teardown of TestExamples.test_repl2[chromium] ____________
[gw6] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

browser = <Browser type=<BrowserType name=chromium executable_path=/home/jglass/.cache/ms-playwright/chromium-1055/chrome-linux/chrome> version=112.0.5615.29>
browser_context_args = {}
pytestconfig = <_pytest.config.Config object at 0x7fee26caf450>
request = <SubRequest 'context' for <Function test_repl2[chromium]>>

    @pytest.fixture
    def context(
        browser: Browser,
        browser_context_args: Dict,
        pytestconfig: Any,
        request: pytest.FixtureRequest,
    ) -> Generator[BrowserContext, None, None]:
        pages: List[Page] = []
        context = browser.new_context(**browser_context_args)
        context.on("page", lambda page: pages.append(page))
    
        tracing_option = pytestconfig.getoption("--tracing")
        capture_trace = tracing_option in ["on", "retain-on-failure"]
        if capture_trace:
            context.tracing.start(
                name=slugify(request.node.nodeid),
                screenshots=True,
                snapshots=True,
                sources=True,
            )
    
        yield context
    
        # If requst.node is missing rep_call, then some error happened during execution
        # that prevented teardown, but should still be counted as a failure
        failed = request.node.rep_call.failed if hasattr(request.node, "rep_call") else True
    
        if capture_trace:
            retain_trace = tracing_option == "on" or (
                failed and tracing_option == "retain-on-failure"
            )
            if retain_trace:
                trace_path = _build_artifact_test_folder(pytestconfig, request, "trace.zip")
                context.tracing.stop(path=trace_path)
            else:
                context.tracing.stop()
    
        screenshot_option = pytestconfig.getoption("--screenshot")
        capture_screenshot = screenshot_option == "on" or (
            failed and screenshot_option == "only-on-failure"
        )
        if capture_screenshot:
            for index, page in enumerate(pages):
                human_readable_status = "failed" if failed else "finished"
                screenshot_path = _build_artifact_test_folder(
                    pytestconfig, request, f"test-{human_readable_status}-{index+1}.png"
                )
                try:
                    page.screenshot(timeout=5000, path=screenshot_path)
                except Error:
                    pass
    
>       context.close()

env/lib/python3.11/site-packages/pytest_playwright/pytest_playwright.py:263: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
env/lib/python3.11/site-packages/playwright/sync_api/_generated.py:13553: in close
    return mapping.from_maybe_impl(self._sync(self._impl_obj.close()))
env/lib/python3.11/site-packages/playwright/_impl/_browser_context.py:448: in close
    await self._channel.send("close")
env/lib/python3.11/site-packages/playwright/_impl/_connection.py:61: in send
    return await self._connection.wrap_api_call(
env/lib/python3.11/site-packages/playwright/_impl/_connection.py:461: in wrap_api_call
    return await cb()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <playwright._impl._connection.Channel object at 0x7fee12cda050>
method = 'close', params = {}, return_as_dict = False

    async def inner_send(
        self, method: str, params: Optional[Dict], return_as_dict: bool
    ) -> Any:
        if params is None:
            params = {}
        callback = self._connection._send_message_to_server(self._guid, method, params)
        if self._connection._error:
            error = self._connection._error
            self._connection._error = None
            raise error
        done, _ = await asyncio.wait(
            {
                self._connection._transport.on_error_future,
                callback.future,
            },
            return_when=asyncio.FIRST_COMPLETED,
        )
        if not callback.future.done():
            callback.future.cancel()
>       result = next(iter(done)).result()
E       Exception: Connection closed while reading from the driver

env/lib/python3.11/site-packages/playwright/_impl/_connection.py:96: Exception
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] examples/repl2.html[00m
[34;01m[  0.01 request          ] 200 - fake_server - http://fake_server/examples/repl2.html[00m
[34;01m[  0.02 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/examples/repl.css[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/examples/assets/css/examples.css[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[34;01m[  0.04 request          ] 200 - fake_server - http://fake_server/examples/logo.png[00m
[  0.17 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  0.17 console.info     ] [36m[py-config][00m loading <py-config> content
[  0.17 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "type": "app",
  "schema_version": 1,
  "runtimes": [],
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "packages": [
    "bokeh",
    "numpy"
  ],
  "fetch": [
    {
      "files": [
        "./utils.py",
        "./antigravity.py"
      ]
    }
  ],
  "plugins": [
    "../build/plugins/python/py_tutor.py"
  ],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T17:00:17.483Z"
  }
}
[  0.17 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  0.17 console.info     ] [36m[py-terminal][00m No <py-terminal> found, adding one
[  0.17 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  0.17 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...
[34;01m[  0.18 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js[00m
[  0.19 console.info     ] [36m[pyscript/main][00m Python startup...
[34;01m[  0.22 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_stdlib.zip[00m
[34;01m[  0.28 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.js[00m
[34;01m[  1.57 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/repodata.json[00m
[34;01m[  1.83 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.wasm[00m
[  5.13 console.info     ] [36m[pyscript/pyodide][00m importing pyscript
[  5.18 console.info     ] [36m[pyscript/pyodide][00m Found packages in configuration to install. Loading micropip...
[  5.19 console.info     ] [36m[pyscript/pyodide][00m pyodide.loadPackage: micropip
[  5.19 console.info     ] [36m[pyscript/pyodide][00m Loading micropip, packaging, pyparsing
[34;01m[  5.19 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/micropip-0.3.0-py3-none-any.whl[00m
[34;01m[  5.19 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/packaging-23.0-py3-none-any.whl[00m
[34;01m[  5.20 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyparsing-3.0.9-py3-none-any.whl[00m
[  5.28 console.info     ] [36m[pyscript/pyodide][00m Loaded pyparsing, packaging, micropip
[  5.39 console.info     ] [36m[pyscript/pyodide][00m pyodide loaded and initialized
[  5.39 console.log      ] Python initialization complete
[  5.39 console.info     ] [36m[pyscript/main][00m Python ready!
[  5.39 console.info     ] [36m[pyscript/main][00m Setting up virtual environment...
[  5.62 console.info     ] [36m[pyscript/main][00m Packages to install:  [bokeh, numpy]
[  5.62 console.info     ] [36m[pyscript/main][00m Fetching urls: ./utils.py, ./antigravity.py
[  5.62 console.info     ] [36m[pyscript/pyodide][00m micropip install bokeh,numpy
[34;01m[  5.62 request          ] 200 - fake_server - http://fake_server/examples/utils.py[00m
[34;01m[  5.62 request          ] 200 - fake_server - http://fake_server/examples/antigravity.py[00m
[  5.64 console.log      ] Loading bokeh, distutils, numpy, jinja2, markupsafe, pillow, python-dateutil, six, typing-extensions, pyyaml
[34;01m[  5.76 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/numpy-1.24.2-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  5.84 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/Jinja2-3.1.2-py3-none-any.whl[00m
[34;01m[  5.85 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/MarkupSafe-2.1.2-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  5.89 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/PIL-9.1.1-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  5.91 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_dateutil-2.8.2-py2.py3-none-any.whl[00m
[34;01m[  5.92 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/six-1.16.0-py2.py3-none-any.whl[00m
[34;01m[  5.92 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/typing_extensions-4.5.0-py3-none-any.whl[00m
[34;01m[  5.93 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/PyYAML-6.0-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[  5.94 console.info     ] [36m[pyscript/main][00m     Fetched ./utils.py ==> ./utils.py
[  5.94 console.info     ] [36m[pyscript/main][00m     Fetched ./antigravity.py ==> ./antigravity.py
[  5.94 console.info     ] [36m[pyscript/main][00m Fetched all paths
[34;01m[  7.15 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/distutils-1.0.0.zip[00m
[34;01m[ 22.94 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/bokeh-3.1.0-py3-none-any.whl[00m
----------------------------- Captured stderr call -----------------------------
Killed

tests/integration/test_stdio_handling.py::TestOutputHandling::test_targeted_stdio_interleaved[chromium] 
[gw4] [ 41%] FAILED tests/integration/test_py_config.py::TestConfig::test_interpreter_config[chromium] 
_________________ TestConfig.test_interpreter_config[chromium] _________________
[gw4] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

self = <integration.test_py_config.TestConfig object at 0x7f5a4bfe7090>
tar_location = '/tmp/tmpisdve_uq/pyodide-build-0.20.0.tar.bz2'

    def test_interpreter_config(self, tar_location):
        unzip(
            location=tar_location,
            extract_to=self.tmpdir,
        )
    
>       self.pyscript_run(
            """
            <py-config type="json">
                {
                    "interpreters": [{
                        "src": "/pyodide/pyodide.js",
                        "name": "pyodide-0.20.0",
                        "lang": "python"
                    }]
                }
            </py-config>
    
            <py-script>
                import sys, js
                pyodide_version = sys.modules["pyodide"].__version__
                js.console.log("version", pyodide_version)
                display(pyodide_version)
            </py-script>
        """,
        )

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/test_py_config.py:82: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:318: in pyscript_run
    self.goto(filename)
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:220: in goto
    self.page.goto(url, timeout=0)
/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/sync_api/_generated.py:9221: in goto
    self._sync(
/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_page.py:495: in goto
    return await self._main_frame.goto(**locals_to_params(locals()))
/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_frame.py:147: in goto
    await self._channel.send("goto", locals_to_params(locals()))
/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py:61: in send
    return await self._connection.wrap_api_call(
/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py:461: in wrap_api_call
    return await cb()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <playwright._impl._connection.Channel object at 0x7f5a3eac6550>
method = 'goto'
params = {'timeout': 0, 'url': 'http://fake_server/interpreter_config.html'}
return_as_dict = False

    async def inner_send(
        self, method: str, params: Optional[Dict], return_as_dict: bool
    ) -> Any:
        if params is None:
            params = {}
        callback = self._connection._send_message_to_server(self._guid, method, params)
        if self._connection._error:
            error = self._connection._error
            self._connection._error = None
            raise error
        done, _ = await asyncio.wait(
            {
                self._connection._transport.on_error_future,
                callback.future,
            },
            return_when=asyncio.FIRST_COMPLETED,
        )
        if not callback.future.done():
            callback.future.cancel()
>       result = next(iter(done)).result()
E       playwright._impl._api_types.Error: Navigation failed because page crashed!
E       =========================== logs ===========================
E       navigating to "http://fake_server/interpreter_config.html", waiting until "load"
E       ============================================================

/home/jglass/Documents/pyscript/pyscriptjs/env/lib/python3.11/site-packages/playwright/_impl/_connection.py:96: Error
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] interpreter_config.html[00m

tests/integration/test_zz_examples.py::TestExamples::test_panel_stream[chromium] 
[gw7] [ 41%] FAILED tests/integration/test_02_display.py::TestOutput::test_display_multiple_values[chromium] 
______________ TestOutput.test_display_multiple_values[chromium] _______________
[gw7] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

self = <integration.test_02_display.TestOutput object at 0x7f0cc934b050>

    def test_display_multiple_values(self):
>       self.pyscript_run(
            """
            <py-script>
                hello = 'hello'
                world = 'world'
                display(hello, world)
            </py-script>
            """
        )

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/test_02_display.py:205: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:320: in pyscript_run
    self.wait_for_pyscript(timeout=timeout)
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:274: in wait_for_pyscript
    elapsed_ms = self.wait_for_console(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <integration.test_02_display.TestOutput object at 0x7f0cc934b050>
text = '[pyscript/main] PyScript page fully initialized'

    def wait_for_console(self, text, *, timeout=None, check_js_errors=True):
        """
        Wait until the given message appear in the console. If the message was
        already printed in the console, return immediately.
    
        Note: it must be the *exact* string as printed by e.g. console.log.
    
        timeout is expressed in milliseconds. If it's None, it will use
        the same default as playwright, which is 30 seconds.
    
        If check_js_errors is True (the default), it also checks that no JS
        errors were raised during the waiting.
    
        Return the elapsed time in ms.
        """
        if timeout is None:
            timeout = 30 * 1000
        # NOTE: we cannot use playwright's own page.expect_console_message(),
        # because if you call it AFTER the text has already been emitted, it
        # waits forever. Instead, we have to use our own custom logic.
        try:
            t0 = time.time()
            while True:
                elapsed_ms = (time.time() - t0) * 1000
                if elapsed_ms > timeout:
>                   raise TimeoutError(f"{elapsed_ms:.2f} ms")
E                   TimeoutError: 35133.41 ms

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:247: TimeoutError
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] display_multiple_values.html[00m
[34;01m[  0.01 request          ] 200 - fake_server - http://fake_server/display_multiple_values.html[00m
[34;01m[  0.05 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.05 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[  0.29 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  0.30 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "schema_version": 1,
  "type": "app",
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "runtimes": [],
  "packages": [],
  "fetch": [],
  "plugins": [],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T17:00:52.038Z"
  }
}
[  0.30 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  0.30 console.info     ] [36m[py-terminal][00m No <py-terminal> found, adding one
[  0.30 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  0.30 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...
[34;01m[  0.31 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js[00m
[  0.31 console.info     ] [36m[pyscript/main][00m Python startup...
[34;01m[  0.37 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_stdlib.zip[00m
[34;01m[  0.45 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.js[00m
[34;01m[  1.33 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/repodata.json[00m
[34;01m[  1.49 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.wasm[00m
[gw5] [ 42%] FAILED tests/integration/test_py_repl.py::TestPyRepl::test_repl_src_change[chromium] 
__________________ TestPyRepl.test_repl_src_change[chromium] ___________________
[gw5] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

self = <integration.test_py_repl.TestPyRepl object at 0x7f97f5674550>

    def test_repl_src_change(self):
        self.writefile("loadReplSrc2.py", "2")
        self.writefile("loadReplSrc3.py", "print('3')")
>       self.pyscript_run(
            """
            <py-repl id="py-repl2" output="replOutput2" src="./loadReplSrc2.py"></py-repl>
            <div id="replOutput2"></div>
    
            <py-repl id="py-repl3" output="replOutput3">
                import js
                target_tag = js.document.getElementById("py-repl2")
                target_tag.setAttribute("src", "./loadReplSrc3.py")
            </py-repl>
            <div id="replOutput3"></div>
            """
        )

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/test_py_repl.py:598: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:320: in pyscript_run
    self.wait_for_pyscript(timeout=timeout)
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:274: in wait_for_pyscript
    elapsed_ms = self.wait_for_console(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <integration.test_py_repl.TestPyRepl object at 0x7f97f5674550>
text = '[pyscript/main] PyScript page fully initialized'

    def wait_for_console(self, text, *, timeout=None, check_js_errors=True):
        """
        Wait until the given message appear in the console. If the message was
        already printed in the console, return immediately.
    
        Note: it must be the *exact* string as printed by e.g. console.log.
    
        timeout is expressed in milliseconds. If it's None, it will use
        the same default as playwright, which is 30 seconds.
    
        If check_js_errors is True (the default), it also checks that no JS
        errors were raised during the waiting.
    
        Return the elapsed time in ms.
        """
        if timeout is None:
            timeout = 30 * 1000
        # NOTE: we cannot use playwright's own page.expect_console_message(),
        # because if you call it AFTER the text has already been emitted, it
        # waits forever. Instead, we have to use our own custom logic.
        try:
            t0 = time.time()
            while True:
                elapsed_ms = (time.time() - t0) * 1000
                if elapsed_ms > timeout:
>                   raise TimeoutError(f"{elapsed_ms:.2f} ms")
E                   TimeoutError: 34828.35 ms

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:247: TimeoutError
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] repl_src_change.html[00m
[34;01m[  0.01 request          ] 200 - fake_server - http://fake_server/repl_src_change.html[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[  0.25 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  0.25 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "schema_version": 1,
  "type": "app",
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "runtimes": [],
  "packages": [],
  "fetch": [],
  "plugins": [],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T17:00:52.347Z"
  }
}
[  0.25 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  0.25 console.info     ] [36m[py-terminal][00m No <py-terminal> found, adding one
[  0.25 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  0.25 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...
[34;01m[  0.27 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js[00m
[  0.29 console.info     ] [36m[pyscript/main][00m Python startup...
[34;01m[  0.33 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_stdlib.zip[00m
[34;01m[  0.43 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.js[00m
[34;01m[  1.33 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/repodata.json[00m
[34;01m[  1.47 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.wasm[00m
[gw3] [ 42%] FAILED tests/integration/test_stdio_handling.py::TestOutputHandling::test_stdio_target_element_id_change[chromium] 
_______ TestOutputHandling.test_stdio_target_element_id_change[chromium] _______
[gw3] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

self = <integration.test_stdio_handling.TestOutputHandling object at 0x7fc1b1365250>

    def test_stdio_target_element_id_change(self):
        # If the user changes the ID of the targeted DOM element mid-execution,
        # Output should no longer go to the selected element and a warning should appear
>       self.pyscript_run(
            """
            <div id="first"></div>
            <div id="second"></div>
            <!-- There is no tag with id "third" -->
            <py-script id="pyscript-tag" output="first">
                print("one.")
    
                # Change the ID of the targeted DIV to something else
                import js
                target_tag = js.document.getElementById("first")
    
                # should fail and show banner
                target_tag.setAttribute("id", "second")
                print("two.")
    
                # But changing both the 'output' attribute and the id of the target
                # should work
                target_tag.setAttribute("id", "third")
                js.document.getElementById("pyscript-tag").setAttribute("output", "third")
                print("three.")
            </py-script>
            """
        )

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/test_stdio_handling.py:331: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:320: in pyscript_run
    self.wait_for_pyscript(timeout=timeout)
/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:274: in wait_for_pyscript
    elapsed_ms = self.wait_for_console(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <integration.test_stdio_handling.TestOutputHandling object at 0x7fc1b1365250>
text = '[pyscript/main] PyScript page fully initialized'

    def wait_for_console(self, text, *, timeout=None, check_js_errors=True):
        """
        Wait until the given message appear in the console. If the message was
        already printed in the console, return immediately.
    
        Note: it must be the *exact* string as printed by e.g. console.log.
    
        timeout is expressed in milliseconds. If it's None, it will use
        the same default as playwright, which is 30 seconds.
    
        If check_js_errors is True (the default), it also checks that no JS
        errors were raised during the waiting.
    
        Return the elapsed time in ms.
        """
        if timeout is None:
            timeout = 30 * 1000
        # NOTE: we cannot use playwright's own page.expect_console_message(),
        # because if you call it AFTER the text has already been emitted, it
        # waits forever. Instead, we have to use our own custom logic.
        try:
            t0 = time.time()
            while True:
                elapsed_ms = (time.time() - t0) * 1000
                if elapsed_ms > timeout:
>                   raise TimeoutError(f"{elapsed_ms:.2f} ms")
E                   TimeoutError: 30854.27 ms

/home/jglass/Documents/pyscript/pyscriptjs/tests/integration/support.py:247: TimeoutError
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] stdio_target_element_id_change.html[00m
[34;01m[  0.01 request          ] 200 - fake_server - http://fake_server/stdio_target_element_id_change.html[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[  0.23 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  0.24 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "schema_version": 1,
  "type": "app",
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "runtimes": [],
  "packages": [],
  "fetch": [],
  "plugins": [],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T17:00:56.313Z"
  }
}
[  0.24 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  0.24 console.info     ] [36m[py-terminal][00m No <py-terminal> found, adding one
[  0.24 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  0.24 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...

tests/integration/test_01_basic.py::TestBasic::test_getPySrc_returns_source_code[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_panel_kmeans[chromium] 
tests/integration/test_02_display.py::TestOutput::test_display_multiple_append_false_with_target[chromium] 
[gw1] [ 43%] FAILED tests/integration/test_zz_examples.py::TestExamples::test_numpy_canvas_fractals[chromium] 
______________ TestExamples.test_numpy_canvas_fractals[chromium] _______________
[gw1] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

self = <integration.test_zz_examples.TestExamples object at 0x7f20391a0d90>

    def test_numpy_canvas_fractals(self):
        self.goto("examples/numpy_canvas_fractals.html")
>       self.wait_for_pyscript(timeout=60 * 1000)

tests/integration/test_zz_examples.py:203: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/integration/support.py:274: in wait_for_pyscript
    elapsed_ms = self.wait_for_console(
tests/integration/support.py:253: in wait_for_console
    self.page.wait_for_timeout(50)
env/lib/python3.11/site-packages/playwright/sync_api/_generated.py:11734: in wait_for_timeout
    self._sync(self._impl_obj.wait_for_timeout(timeout=timeout))
env/lib/python3.11/site-packages/playwright/_impl/_page.py:948: in wait_for_timeout
    await self._main_frame.wait_for_timeout(timeout)
env/lib/python3.11/site-packages/playwright/_impl/_frame.py:748: in wait_for_timeout
    await self._channel.send("waitForTimeout", locals_to_params(locals()))
env/lib/python3.11/site-packages/playwright/_impl/_connection.py:61: in send
    return await self._connection.wrap_api_call(
env/lib/python3.11/site-packages/playwright/_impl/_connection.py:461: in wrap_api_call
    return await cb()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <playwright._impl._connection.Channel object at 0x7f203924e090>
method = 'waitForTimeout', params = {'timeout': 50}, return_as_dict = False

    async def inner_send(
        self, method: str, params: Optional[Dict], return_as_dict: bool
    ) -> Any:
        if params is None:
            params = {}
        callback = self._connection._send_message_to_server(self._guid, method, params)
        if self._connection._error:
            error = self._connection._error
            self._connection._error = None
            raise error
        done, _ = await asyncio.wait(
            {
                self._connection._transport.on_error_future,
                callback.future,
            },
            return_when=asyncio.FIRST_COMPLETED,
        )
        if not callback.future.done():
            callback.future.cancel()
>       result = next(iter(done)).result()
E       Exception: Connection closed while reading from the driver

env/lib/python3.11/site-packages/playwright/_impl/_connection.py:96: Exception
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] examples/numpy_canvas_fractals.html[00m
[34;01m[  0.01 request          ] 200 - fake_server - http://fake_server/examples/numpy_canvas_fractals.html[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[34;01m[  0.04 request          ] 200 - fake_server - http://fake_server/examples/assets/css/examples.css[00m
[34;01m[  0.05 request          ] 200 - fake_server - http://fake_server/examples/logo.png[00m
[  0.20 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  0.20 console.info     ] [36m[py-config][00m loading <py-config> content
[  0.20 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "type": "app",
  "schema_version": 1,
  "runtimes": [],
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "packages": [
    "numpy",
    "sympy"
  ],
  "fetch": [
    {
      "files": [
        "./palettes.py",
        "./fractals.py"
      ]
    }
  ],
  "plugins": [
    "../build/plugins/python/py_tutor.py"
  ],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T17:00:46.032Z"
  }
}
[  0.20 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  0.20 console.info     ] [36m[py-terminal][00m No <py-terminal> found, adding one
[  0.20 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  0.20 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...
[34;01m[  0.21 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js[00m
[  0.23 console.info     ] [36m[pyscript/main][00m Python startup...
[34;01m[  0.26 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_stdlib.zip[00m
[34;01m[  0.36 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.js[00m
[34;01m[  1.21 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/repodata.json[00m
[34;01m[  1.39 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.wasm[00m
[  4.57 console.info     ] [36m[pyscript/pyodide][00m importing pyscript
[  4.62 console.info     ] [36m[pyscript/pyodide][00m Found packages in configuration to install. Loading micropip...
[  4.62 console.info     ] [36m[pyscript/pyodide][00m pyodide.loadPackage: micropip
[  4.62 console.info     ] [36m[pyscript/pyodide][00m Loading micropip, packaging, pyparsing
[34;01m[  4.64 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/micropip-0.3.0-py3-none-any.whl[00m
[34;01m[  4.64 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/packaging-23.0-py3-none-any.whl[00m
[34;01m[  4.66 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyparsing-3.0.9-py3-none-any.whl[00m
[  4.76 console.info     ] [36m[pyscript/pyodide][00m Loaded pyparsing, packaging, micropip
[  4.87 console.info     ] [36m[pyscript/pyodide][00m pyodide loaded and initialized
[  4.87 console.log      ] Python initialization complete
[  4.87 console.info     ] [36m[pyscript/main][00m Python ready!
[  4.87 console.info     ] [36m[pyscript/main][00m Setting up virtual environment...
[  5.16 console.info     ] [36m[pyscript/main][00m Packages to install:  [numpy, sympy]
[  5.16 console.info     ] [36m[pyscript/main][00m Fetching urls: ./palettes.py, ./fractals.py
[  5.17 console.info     ] [36m[pyscript/pyodide][00m micropip install numpy,sympy
[34;01m[  5.17 request          ] 200 - fake_server - http://fake_server/examples/palettes.py[00m
[34;01m[  5.17 request          ] 200 - fake_server - http://fake_server/examples/fractals.py[00m
[  5.18 console.log      ] Loading numpy, sympy, distutils, mpmath
[34;01m[  5.36 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/numpy-1.24.2-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  5.46 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/distutils-1.0.0.zip[00m
[  5.47 console.info     ] [36m[pyscript/main][00m     Fetched ./palettes.py ==> ./palettes.py
[  5.47 console.info     ] [36m[pyscript/main][00m     Fetched ./fractals.py ==> ./fractals.py
[  5.47 console.info     ] [36m[pyscript/main][00m Fetched all paths
[34;01m[  7.46 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/mpmath-1.3.0-py3-none-any.whl[00m
[34;01m[  9.68 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/sympy-1.11.1-py3-none-any.whl[00m
----------------------------- Captured stderr call -----------------------------
Killed
[gw1] [ 43%] ERROR tests/integration/test_zz_examples.py::TestExamples::test_numpy_canvas_fractals[chromium] 
____ ERROR at teardown of TestExamples.test_numpy_canvas_fractals[chromium] ____
[gw1] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

browser = <Browser type=<BrowserType name=chromium executable_path=/home/jglass/.cache/ms-playwright/chromium-1055/chrome-linux/chrome> version=112.0.5615.29>
browser_context_args = {}
pytestconfig = <_pytest.config.Config object at 0x7f204c32f350>
request = <SubRequest 'context' for <Function test_numpy_canvas_fractals[chromium]>>

    @pytest.fixture
    def context(
        browser: Browser,
        browser_context_args: Dict,
        pytestconfig: Any,
        request: pytest.FixtureRequest,
    ) -> Generator[BrowserContext, None, None]:
        pages: List[Page] = []
        context = browser.new_context(**browser_context_args)
        context.on("page", lambda page: pages.append(page))
    
        tracing_option = pytestconfig.getoption("--tracing")
        capture_trace = tracing_option in ["on", "retain-on-failure"]
        if capture_trace:
            context.tracing.start(
                name=slugify(request.node.nodeid),
                screenshots=True,
                snapshots=True,
                sources=True,
            )
    
        yield context
    
        # If requst.node is missing rep_call, then some error happened during execution
        # that prevented teardown, but should still be counted as a failure
        failed = request.node.rep_call.failed if hasattr(request.node, "rep_call") else True
    
        if capture_trace:
            retain_trace = tracing_option == "on" or (
                failed and tracing_option == "retain-on-failure"
            )
            if retain_trace:
                trace_path = _build_artifact_test_folder(pytestconfig, request, "trace.zip")
                context.tracing.stop(path=trace_path)
            else:
                context.tracing.stop()
    
        screenshot_option = pytestconfig.getoption("--screenshot")
        capture_screenshot = screenshot_option == "on" or (
            failed and screenshot_option == "only-on-failure"
        )
        if capture_screenshot:
            for index, page in enumerate(pages):
                human_readable_status = "failed" if failed else "finished"
                screenshot_path = _build_artifact_test_folder(
                    pytestconfig, request, f"test-{human_readable_status}-{index+1}.png"
                )
                try:
                    page.screenshot(timeout=5000, path=screenshot_path)
                except Error:
                    pass
    
>       context.close()

env/lib/python3.11/site-packages/pytest_playwright/pytest_playwright.py:263: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
env/lib/python3.11/site-packages/playwright/sync_api/_generated.py:13553: in close
    return mapping.from_maybe_impl(self._sync(self._impl_obj.close()))
env/lib/python3.11/site-packages/playwright/_impl/_browser_context.py:448: in close
    await self._channel.send("close")
env/lib/python3.11/site-packages/playwright/_impl/_connection.py:61: in send
    return await self._connection.wrap_api_call(
env/lib/python3.11/site-packages/playwright/_impl/_connection.py:461: in wrap_api_call
    return await cb()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <playwright._impl._connection.Channel object at 0x7f203837fc10>
method = 'close', params = {}, return_as_dict = False

    async def inner_send(
        self, method: str, params: Optional[Dict], return_as_dict: bool
    ) -> Any:
        if params is None:
            params = {}
        callback = self._connection._send_message_to_server(self._guid, method, params)
        if self._connection._error:
            error = self._connection._error
            self._connection._error = None
            raise error
        done, _ = await asyncio.wait(
            {
                self._connection._transport.on_error_future,
                callback.future,
            },
            return_when=asyncio.FIRST_COMPLETED,
        )
        if not callback.future.done():
            callback.future.cancel()
>       result = next(iter(done)).result()
E       Exception: Connection closed while reading from the driver

env/lib/python3.11/site-packages/playwright/_impl/_connection.py:96: Exception
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] examples/numpy_canvas_fractals.html[00m
[34;01m[  0.01 request          ] 200 - fake_server - http://fake_server/examples/numpy_canvas_fractals.html[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.03 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[34;01m[  0.04 request          ] 200 - fake_server - http://fake_server/examples/assets/css/examples.css[00m
[34;01m[  0.05 request          ] 200 - fake_server - http://fake_server/examples/logo.png[00m
[  0.20 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  0.20 console.info     ] [36m[py-config][00m loading <py-config> content
[  0.20 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "type": "app",
  "schema_version": 1,
  "runtimes": [],
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "packages": [
    "numpy",
    "sympy"
  ],
  "fetch": [
    {
      "files": [
        "./palettes.py",
        "./fractals.py"
      ]
    }
  ],
  "plugins": [
    "../build/plugins/python/py_tutor.py"
  ],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T17:00:46.032Z"
  }
}
[  0.20 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  0.20 console.info     ] [36m[py-terminal][00m No <py-terminal> found, adding one
[  0.20 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  0.20 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...
[34;01m[  0.21 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js[00m
[  0.23 console.info     ] [36m[pyscript/main][00m Python startup...
[34;01m[  0.26 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_stdlib.zip[00m
[34;01m[  0.36 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.js[00m
[34;01m[  1.21 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/repodata.json[00m
[34;01m[  1.39 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.wasm[00m
[  4.57 console.info     ] [36m[pyscript/pyodide][00m importing pyscript
[  4.62 console.info     ] [36m[pyscript/pyodide][00m Found packages in configuration to install. Loading micropip...
[  4.62 console.info     ] [36m[pyscript/pyodide][00m pyodide.loadPackage: micropip
[  4.62 console.info     ] [36m[pyscript/pyodide][00m Loading micropip, packaging, pyparsing
[34;01m[  4.64 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/micropip-0.3.0-py3-none-any.whl[00m
[34;01m[  4.64 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/packaging-23.0-py3-none-any.whl[00m
[34;01m[  4.66 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyparsing-3.0.9-py3-none-any.whl[00m
[  4.76 console.info     ] [36m[pyscript/pyodide][00m Loaded pyparsing, packaging, micropip
[  4.87 console.info     ] [36m[pyscript/pyodide][00m pyodide loaded and initialized
[  4.87 console.log      ] Python initialization complete
[  4.87 console.info     ] [36m[pyscript/main][00m Python ready!
[  4.87 console.info     ] [36m[pyscript/main][00m Setting up virtual environment...
[  5.16 console.info     ] [36m[pyscript/main][00m Packages to install:  [numpy, sympy]
[  5.16 console.info     ] [36m[pyscript/main][00m Fetching urls: ./palettes.py, ./fractals.py
[  5.17 console.info     ] [36m[pyscript/pyodide][00m micropip install numpy,sympy
[34;01m[  5.17 request          ] 200 - fake_server - http://fake_server/examples/palettes.py[00m
[34;01m[  5.17 request          ] 200 - fake_server - http://fake_server/examples/fractals.py[00m
[  5.18 console.log      ] Loading numpy, sympy, distutils, mpmath
[34;01m[  5.36 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/numpy-1.24.2-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  5.46 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/distutils-1.0.0.zip[00m
[  5.47 console.info     ] [36m[pyscript/main][00m     Fetched ./palettes.py ==> ./palettes.py
[  5.47 console.info     ] [36m[pyscript/main][00m     Fetched ./fractals.py ==> ./fractals.py
[  5.47 console.info     ] [36m[pyscript/main][00m Fetched all paths
[34;01m[  7.46 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/mpmath-1.3.0-py3-none-any.whl[00m
[34;01m[  9.68 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/sympy-1.11.1-py3-none-any.whl[00m
----------------------------- Captured stderr call -----------------------------
Killed

tests/integration/test_01_basic.py::TestBasic::test_py_script_src_not_found[chromium] 
[gw0] [ 43%] FAILED tests/integration/test_zz_examples.py::TestExamples::test_panel_deckgl[chromium] 
___________________ TestExamples.test_panel_deckgl[chromium] ___________________
[gw0] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

self = <integration.test_zz_examples.TestExamples object at 0x7f83980fdf90>

    def test_panel_deckgl(self):
        # XXX improve this test
        self.goto("examples/panel_deckgl.html")
>       self.wait_for_pyscript(timeout=90 * 1000)

tests/integration/test_zz_examples.py:271: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/integration/support.py:274: in wait_for_pyscript
    elapsed_ms = self.wait_for_console(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <integration.test_zz_examples.TestExamples object at 0x7f83980fdf90>
text = '[pyscript/main] PyScript page fully initialized'

    def wait_for_console(self, text, *, timeout=None, check_js_errors=True):
        """
        Wait until the given message appear in the console. If the message was
        already printed in the console, return immediately.
    
        Note: it must be the *exact* string as printed by e.g. console.log.
    
        timeout is expressed in milliseconds. If it's None, it will use
        the same default as playwright, which is 30 seconds.
    
        If check_js_errors is True (the default), it also checks that no JS
        errors were raised during the waiting.
    
        Return the elapsed time in ms.
        """
        if timeout is None:
            timeout = 30 * 1000
        # NOTE: we cannot use playwright's own page.expect_console_message(),
        # because if you call it AFTER the text has already been emitted, it
        # waits forever. Instead, we have to use our own custom logic.
        try:
            t0 = time.time()
            while True:
                elapsed_ms = (time.time() - t0) * 1000
                if elapsed_ms > timeout:
>                   raise TimeoutError(f"{elapsed_ms:.2f} ms")
E                   TimeoutError: 90049.98 ms

tests/integration/support.py:247: TimeoutError
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] examples/panel_deckgl.html[00m
[34;01m[  0.01 request          ] 200 - fake_server - http://fake_server/examples/panel_deckgl.html[00m
[34;01m[  0.06 request          ] 200 - CACHED - https://cdn.bokeh.org/bokeh/release/bokeh-2.4.3.js[00m
[34;01m[  0.09 request          ] 200 - CACHED - https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.3.min.js[00m
[34;01m[  0.11 request          ] 200 - CACHED - https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.4.3.min.js[00m
[34;01m[  0.13 request          ] 200 - CACHED - https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js[00m
[34;01m[  0.14 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.14 request          ] 200 - fake_server - http://fake_server/examples/assets/css/examples.css[00m
[34;01m[  0.27 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/npm/@deck.gl/json@8.6.7/dist.min.js[00m
[34;01m[  0.29 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/npm/@loaders.gl/json@3.1.7/dist/dist.min.js[00m
[34;01m[  0.47 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/npm/deck.gl@8.6.7/dist.min.js[00m
[34;01m[  0.54 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js[00m
[34;01m[  0.55 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css[00m
[34;01m[  0.57 request          ] 200 - NETWORK - https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js[00m
[34;01m[  0.58 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/npm/@loaders.gl/csv@3.1.7/dist/dist.min.js[00m
[34;01m[  0.61 request          ] 200 - NETWORK - https://unpkg.com/h3-js@3.7.2/dist/h3-js.umd.js[00m
[34;01m[  0.63 request          ] 200 - NETWORK - https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css[00m
[34;01m[  0.65 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/npm/@loaders.gl/3d-tiles@3.1.7/dist/dist.min.js[00m
[34;01m[  1.39 request          ] 200 - NETWORK - https://unpkg.com/@holoviz/panel@0.13.1/dist/bundled/defaulttheme/default.css[00m
[34;01m[  1.63 request          ] 200 - NETWORK - https://unpkg.com/@holoviz/panel@0.13.1/dist/bundled/bootstraptemplate/bootstrap.css[00m
[34;01m[  2.49 request          ] 200 - NETWORK - https://unpkg.com/@holoviz/panel@0.13.1/dist/css/markdown.css[00m
[34;01m[  2.50 request          ] 200 - NETWORK - https://unpkg.com/@holoviz/panel@0.13.1/dist/css/widgets.css[00m
[34;01m[  2.51 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[31m[  2.61 console.error    ] loaders.gl: The __VERSION__ variable is not injected using babel plugin. Latest unstable workers would be fetched from the CDN.[00m
[34;01m[  2.63 request          ] 200 - NETWORK - https://unpkg.com/@holoviz/panel@0.13.1/dist/panel.js[00m
[34;01m[  2.87 request          ] 200 - fake_server - http://fake_server/examples/logo.png[00m
[  3.01 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  3.01 console.info     ] [36m[py-config][00m loading <py-config> content
[  3.02 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "type": "app",
  "schema_version": 1,
  "runtimes": [],
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "packages": [
    "https://cdn.holoviz.org/panel/0.14.3/dist/wheels/bokeh-2.4.3-py3-none-any.whl",
    "numpy",
    "pandas",
    "panel==0.13.1"
  ],
  "fetch": [],
  "plugins": [
    "../build/plugins/python/py_tutor.py"
  ],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T17:00:49.938Z"
  }
}
[  3.02 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  3.02 console.info     ] [36m[py-terminal][00m No <py-terminal> found, adding one
[  3.02 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  3.02 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...
[34;01m[  3.03 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js[00m
[  3.04 console.info     ] [36m[pyscript/main][00m Python startup...
[34;01m[  3.08 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_stdlib.zip[00m
[34;01m[  3.17 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.js[00m
[34;01m[  3.99 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/repodata.json[00m
[34;01m[  4.13 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.wasm[00m
[  7.64 console.info     ] [36m[pyscript/pyodide][00m importing pyscript
[  7.70 console.info     ] [36m[pyscript/pyodide][00m Found packages in configuration to install. Loading micropip...
[  7.70 console.info     ] [36m[pyscript/pyodide][00m pyodide.loadPackage: micropip
[  7.70 console.info     ] [36m[pyscript/pyodide][00m Loading micropip, packaging, pyparsing
[34;01m[  7.70 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/micropip-0.3.0-py3-none-any.whl[00m
[34;01m[  7.70 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/packaging-23.0-py3-none-any.whl[00m
[34;01m[  7.71 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyparsing-3.0.9-py3-none-any.whl[00m
[  7.91 console.info     ] [36m[pyscript/pyodide][00m Loaded pyparsing, packaging, micropip
[  8.08 console.info     ] [36m[pyscript/pyodide][00m pyodide loaded and initialized
[  8.08 console.log      ] Python initialization complete
[  8.08 console.info     ] [36m[pyscript/main][00m Python ready!
[  8.08 console.info     ] [36m[pyscript/main][00m Setting up virtual environment...
[  8.46 console.info     ] [36m[pyscript/main][00m Packages to install:  [https://cdn.holoviz.org/panel/0.14.3/dist/wheels/bokeh-2.4.3-py3-none-any.whl, numpy, pandas, panel==0.13.1]
[  8.47 console.info     ] [36m[pyscript/main][00m Fetching urls: 
[  8.47 console.info     ] [36m[pyscript/main][00m Fetched all paths
[  8.47 console.info     ] [36m[pyscript/pyodide][00m micropip install https://cdn.holoviz.org/panel/0.14.3/dist/wheels/bokeh-2.4.3-py3-none-any.whl,numpy,pandas,panel==0.13.1
[34;01m[  8.51 request          ] 200 - CACHED - https://cdn.holoviz.org/panel/0.14.3/dist/wheels/bokeh-2.4.3-py3-none-any.whl[00m
[34;01m[  8.86 request          ] 200 - NETWORK - https://pypi.org/pypi/panel/json[00m
[34;01m[ 22.17 request          ] 200 - NETWORK - https://files.pythonhosted.org/packages/12/90/9bde3e224f5f5a616036401b3f70b54f59a775cc7d630f040d7ce8363560/panel-0.13.1-py2.py3-none-any.whl[00m

tests/integration/test_py_repl.py::TestPyRepl::test_repl_output_stderr[chromium] 
[gw0] [ 44%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_repl_output_stderr[chromium] 
tests/integration/test_00_support.py::TestSupport::test_await_with_run_js[chromium] 
[gw0] [ 45%] PASSED tests/integration/test_00_support.py::TestSupport::test_await_with_run_js[chromium] 
tests/integration/test_03_element.py::TestElement::test_element_remove_multiple_classes[chromium] 
[gw0] [ 45%] PASSED tests/integration/test_03_element.py::TestElement::test_element_remove_multiple_classes[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_repl_output_display_async[chromium] 
[gw0] [ 46%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_repl_output_display_async[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_bokeh[chromium] 
[gw0] [ 46%] PASSED tests/integration/test_zz_examples.py::TestExamples::test_bokeh[chromium] 
tests/integration/test_py_config.py::TestConfig::test_runtime_still_works_but_shows_deprecation_warning[chromium] 
[gw0] [ 47%] PASSED tests/integration/test_py_config.py::TestConfig::test_runtime_still_works_but_shows_deprecation_warning[chromium] 
tests/integration/test_py_config.py::TestConfig::test_paths_that_do_not_exist[chromium] 
[gw0] [ 47%] PASSED tests/integration/test_py_config.py::TestConfig::test_paths_that_do_not_exist[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_run_clears_previous_output[chromium] 
[gw0] [ 48%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_run_clears_previous_output[chromium] 
tests/integration/test_style.py::TestStyle::test_pyscript_defined[chromium] 
[gw0] [ 48%] PASSED tests/integration/test_style.py::TestStyle::test_pyscript_defined[chromium] 
tests/integration/test_py_terminal.py::TestPyTerminal::test_config_auto[chromium] 
[gw0] [ 49%] PASSED tests/integration/test_py_terminal.py::TestPyTerminal::test_config_auto[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_hide_previous_error_after_successful_run[chromium] 
[gw0] [ 49%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_hide_previous_error_after_successful_run[chromium] 
tests/integration/test_02_display.py::TestOutput::test_simple_display[chromium] 
[gw0] [ 50%] PASSED tests/integration/test_02_display.py::TestOutput::test_simple_display[chromium] 
tests/integration/test_style.py::TestStyle::test_pyscript_not_defined[chromium] 
[gw0] [ 50%] PASSED tests/integration/test_style.py::TestStyle::test_pyscript_not_defined[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_repl[chromium] 
[gw0] [ 51%] PASSED tests/integration/test_zz_examples.py::TestExamples::test_repl[chromium] 
tests/integration/test_02_display.py::TestOutput::test_multiple_display_calls_same_tag[chromium] 
[gw0] [ 51%] PASSED tests/integration/test_02_display.py::TestOutput::test_multiple_display_calls_same_tag[chromium] 
tests/integration/test_async.py::TestAsync::test_async_display_untargeted[chromium] 
[gw0] [ 52%] PASSED tests/integration/test_async.py::TestAsync::test_async_display_untargeted[chromium] 
tests/integration/test_00_support.py::TestSupport::test_wait_for_console_exception_2[chromium] 
[gw0] [ 52%] PASSED tests/integration/test_00_support.py::TestSupport::test_wait_for_console_exception_2[chromium] 
tests/integration/test_00_support.py::TestSupport::test_404[chromium] 
[gw0] [ 53%] PASSED tests/integration/test_00_support.py::TestSupport::test_404[chromium] 
tests/integration/test_01_basic.py::TestBasic::test_py_script_src_attribute[chromium] 
[gw0] [ 53%] PASSED tests/integration/test_01_basic.py::TestBasic::test_py_script_src_attribute[chromium] 
tests/integration/test_03_element.py::TestElement::test_element_clear_input[chromium] 
[gw0] [ 54%] PASSED tests/integration/test_03_element.py::TestElement::test_element_clear_input[chromium] 
tests/integration/test_plugins.py::TestPlugin::test_pyrepl_exec_hooks[chromium] 
[gw0] [ 54%] PASSED tests/integration/test_plugins.py::TestPlugin::test_pyrepl_exec_hooks[chromium] 
tests/integration/test_01_basic.py::TestBasic::test_pyscript_hello[chromium] 
[gw0] [ 55%] PASSED tests/integration/test_01_basic.py::TestBasic::test_pyscript_hello[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_webgl_raycaster_index[chromium] 
[gw0] [ 56%] PASSED tests/integration/test_zz_examples.py::TestExamples::test_webgl_raycaster_index[chromium] 
tests/integration/test_async.py::TestAsync::test_asyncio_ensure_future[chromium] 
[gw0] [ 56%] PASSED tests/integration/test_async.py::TestAsync::test_asyncio_ensure_future[chromium] 
tests/integration/test_splashscreen.py::TestSplashscreen::test_autoclose_false[chromium] 
[gw0] [ 57%] PASSED tests/integration/test_splashscreen.py::TestSplashscreen::test_autoclose_false[chromium] 
tests/integration/test_py_terminal.py::TestPyTerminal::test_config_true[chromium] 
[gw0] [ 57%] PASSED tests/integration/test_py_terminal.py::TestPyTerminal::test_config_true[chromium] 
tests/integration/test_interpreter.py::TestInterpreterAccess::test_interpreter_python_access[chromium] 
[gw0] [ 58%] PASSED tests/integration/test_interpreter.py::TestInterpreterAccess::test_interpreter_python_access[chromium] 
tests/integration/test_zzz_docs_snippets.py::TestDocsSnippets::test_tutorials_py_config_interpreter[chromium] 
[gw0] [ 58%] PASSED tests/integration/test_zzz_docs_snippets.py::TestDocsSnippets::test_tutorials_py_config_interpreter[chromium] 
tests/integration/test_plugins.py::TestPlugin::test_pyscript_exec_hooks[chromium] 
[gw0] [ 59%] PASSED tests/integration/test_plugins.py::TestPlugin::test_pyscript_exec_hooks[chromium] 
tests/integration/test_py_config.py::TestConfig::test_invalid_json_config[chromium] 
[gw4] [ 59%] FAILED tests/integration/test_zz_examples.py::TestExamples::test_panel_stream[chromium] 
___________________ TestExamples.test_panel_stream[chromium] ___________________
[gw4] linux -- Python 3.11.0 /home/jglass/Documents/pyscript/pyscriptjs/env/bin/python

self = <integration.test_zz_examples.TestExamples object at 0x7f5a3f686ad0>

    def test_panel_stream(self):
        # XXX improve this test
        self.goto("examples/panel_stream.html")
>       self.wait_for_pyscript(timeout=3 * 60 * 1000)

tests/integration/test_zz_examples.py:291: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tests/integration/support.py:274: in wait_for_pyscript
    elapsed_ms = self.wait_for_console(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <integration.test_zz_examples.TestExamples object at 0x7f5a3f686ad0>
text = '[pyscript/main] PyScript page fully initialized'

    def wait_for_console(self, text, *, timeout=None, check_js_errors=True):
        """
        Wait until the given message appear in the console. If the message was
        already printed in the console, return immediately.
    
        Note: it must be the *exact* string as printed by e.g. console.log.
    
        timeout is expressed in milliseconds. If it's None, it will use
        the same default as playwright, which is 30 seconds.
    
        If check_js_errors is True (the default), it also checks that no JS
        errors were raised during the waiting.
    
        Return the elapsed time in ms.
        """
        if timeout is None:
            timeout = 30 * 1000
        # NOTE: we cannot use playwright's own page.expect_console_message(),
        # because if you call it AFTER the text has already been emitted, it
        # waits forever. Instead, we have to use our own custom logic.
        try:
            t0 = time.time()
            while True:
                elapsed_ms = (time.time() - t0) * 1000
                if elapsed_ms > timeout:
>                   raise TimeoutError(f"{elapsed_ms:.2f} ms")
E                   TimeoutError: 180002.42 ms

tests/integration/support.py:247: TimeoutError
---------------------------- Captured stdout setup -----------------------------

----------------------------- Captured stdout call -----------------------------
[33;01m[  0.00 page.goto        ] examples/panel_stream.html[00m
[34;01m[  0.01 request          ] 200 - fake_server - http://fake_server/examples/panel_stream.html[00m
[34;01m[  0.02 request          ] 200 - CACHED - https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css[00m
[34;01m[  0.02 request          ] 200 - CACHED - https://unpkg.com/@holoviz/panel@0.13.1/dist/css/widgets.css[00m
[34;01m[  0.02 request          ] 200 - CACHED - https://unpkg.com/@holoviz/panel@0.13.1/dist/css/markdown.css[00m
[34;01m[  0.03 request          ] 200 - CACHED - https://cdn.bokeh.org/bokeh/release/bokeh-2.4.3.js[00m
[34;01m[  0.05 request          ] 200 - CACHED - https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.3.min.js[00m
[34;01m[  0.05 request          ] 200 - CACHED - https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.4.3.min.js[00m
[34;01m[  0.05 request          ] 200 - CACHED - https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css[00m
[34;01m[  0.06 request          ] 200 - CACHED - https://unpkg.com/@holoviz/panel@0.13.1/dist/bundled/bootstraptemplate/bootstrap.css[00m
[34;01m[  0.06 request          ] 200 - CACHED - https://unpkg.com/@holoviz/panel@0.13.1/dist/bundled/defaulttheme/default.css[00m
[34;01m[  0.06 request          ] 200 - CACHED - https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js[00m
[34;01m[  0.06 request          ] 200 - CACHED - https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js[00m
[34;01m[  0.06 request          ] 200 - fake_server - http://fake_server/build/pyscript.css[00m
[34;01m[  0.06 request          ] 200 - fake_server - http://fake_server/examples/assets/css/examples.css[00m
[34;01m[  0.36 request          ] 200 - NETWORK - https://unpkg.com/@holoviz/panel@0.13.1/dist/panel.min.js[00m
[34;01m[  0.39 request          ] 200 - NETWORK - https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.js[00m
[34;01m[  0.39 request          ] 200 - fake_server - http://fake_server/build/pyscript.js[00m
[34;01m[  0.43 request          ] 200 - fake_server - http://fake_server/examples/logo.png[00m
[  0.56 console.log      ] [36m[bokeh][00m setting log level to: 'info'
[  0.62 console.info     ] [36m[pyscript/main][00m searching for <py-config>
[  0.62 console.info     ] [36m[py-config][00m loading <py-config> content
[  0.63 console.info     ] [36m[pyscript/main][00m config loaded:
{
  "type": "app",
  "schema_version": 1,
  "runtimes": [],
  "interpreters": [
    {
      "src": "https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js",
      "name": "pyodide-0.23.0",
      "lang": "python"
    }
  ],
  "packages": [
    "https://cdn.holoviz.org/panel/0.14.3/dist/wheels/bokeh-2.4.3-py3-none-any.whl",
    "numpy",
    "pandas",
    "panel==0.13.1"
  ],
  "fetch": [],
  "plugins": [
    "../build/plugins/python/py_tutor.py"
  ],
  "pyscript": {
    "version": "2022.12.1.dev",
    "time": "2023-04-13T17:01:13.240Z"
  }
}
[  0.63 console.info     ] [36m[py-splashscreen][00m add py-splashscreen
[  0.63 console.info     ] [36m[py-terminal][00m No <py-terminal> found, adding one
[  0.63 console.info     ] [36m[pyscript/main][00m Initializing interpreter
[  0.63 console.info     ] [36m[pyscript/main][00m Downloading pyodide-0.23.0...
[34;01m[  0.64 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js[00m
[  0.65 console.info     ] [36m[pyscript/main][00m Python startup...
[34;01m[  0.68 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_stdlib.zip[00m
[34;01m[  0.73 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.js[00m
[34;01m[  1.16 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/repodata.json[00m
[34;01m[  1.29 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.asm.wasm[00m
[  3.08 console.info     ] [36m[pyscript/pyodide][00m importing pyscript
[  3.11 console.info     ] [36m[pyscript/pyodide][00m Found packages in configuration to install. Loading micropip...
[  3.11 console.info     ] [36m[pyscript/pyodide][00m pyodide.loadPackage: micropip
[  3.11 console.info     ] [36m[pyscript/pyodide][00m Loading micropip, packaging, pyparsing
[34;01m[  3.12 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/micropip-0.3.0-py3-none-any.whl[00m
[34;01m[  3.12 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/packaging-23.0-py3-none-any.whl[00m
[34;01m[  3.12 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyparsing-3.0.9-py3-none-any.whl[00m
[  3.17 console.info     ] [36m[pyscript/pyodide][00m Loaded pyparsing, packaging, micropip
[  3.25 console.info     ] [36m[pyscript/pyodide][00m pyodide loaded and initialized
[  3.25 console.log      ] Python initialization complete
[  3.26 console.info     ] [36m[pyscript/main][00m Python ready!
[  3.26 console.info     ] [36m[pyscript/main][00m Setting up virtual environment...
[  3.44 console.info     ] [36m[pyscript/main][00m Packages to install:  [https://cdn.holoviz.org/panel/0.14.3/dist/wheels/bokeh-2.4.3-py3-none-any.whl, numpy, pandas, panel==0.13.1]
[  3.44 console.info     ] [36m[pyscript/main][00m Fetching urls: 
[  3.44 console.info     ] [36m[pyscript/main][00m Fetched all paths
[  3.44 console.info     ] [36m[pyscript/pyodide][00m micropip install https://cdn.holoviz.org/panel/0.14.3/dist/wheels/bokeh-2.4.3-py3-none-any.whl,numpy,pandas,panel==0.13.1
[34;01m[  3.47 request          ] 200 - CACHED - https://cdn.holoviz.org/panel/0.14.3/dist/wheels/bokeh-2.4.3-py3-none-any.whl[00m
[34;01m[  3.48 request          ] 200 - CACHED - https://pypi.org/pypi/panel/json[00m
[34;01m[  3.84 request          ] 200 - CACHED - https://files.pythonhosted.org/packages/12/90/9bde3e224f5f5a616036401b3f70b54f59a775cc7d630f040d7ce8363560/panel-0.13.1-py2.py3-none-any.whl[00m
[34;01m[  5.40 request          ] 200 - CACHED - https://pypi.org/pypi/requests/json[00m
[34;01m[  5.42 request          ] 200 - CACHED - https://pypi.org/pypi/markdown/json[00m
[34;01m[  5.45 request          ] 200 - CACHED - https://files.pythonhosted.org/packages/d2/f4/274d1dbe96b41cf4e0efb70cbced278ffd61b5c7bb70338b62af94ccb25b/requests-2.28.2-py3-none-any.whl[00m
[34;01m[  5.45 request          ] 200 - CACHED - https://files.pythonhosted.org/packages/9a/a1/1352b0e5a3c71a79fa9265726e2217f69df9fd4de0bcb5725cc61f62a5df/Markdown-3.4.3-py3-none-any.whl[00m
[34;01m[  5.46 request          ] 200 - CACHED - https://pypi.org/pypi/charset-normalizer/json[00m
[34;01m[  5.47 request          ] 200 - CACHED - https://pypi.org/pypi/urllib3/json[00m
[34;01m[  5.54 request          ] 200 - CACHED - https://files.pythonhosted.org/packages/ef/81/14b3b8f01ddaddad6cdec97f2f599aa2fa466bd5ee9af99b08b7713ccd29/charset_normalizer-3.1.0-py3-none-any.whl[00m
[34;01m[  5.55 request          ] 200 - CACHED - https://files.pythonhosted.org/packages/7b/f5/890a0baca17a61c1f92f72b81d3c31523c99bec609e60c292ea55b387ae8/urllib3-1.26.15-py2.py3-none-any.whl[00m
[34;01m[  5.61 request          ] 200 - NETWORK - https://pypi.org/pypi/pyviz-comms/json[00m
[34;01m[  5.63 request          ] 200 - NETWORK - https://pypi.org/pypi/pyct/json[00m
[34;01m[  5.64 request          ] 200 - NETWORK - https://pypi.org/pypi/param/json[00m
[34;01m[  5.85 request          ] 200 - NETWORK - https://files.pythonhosted.org/packages/75/e7/c7c1e9e1b6b23ca1db7af3c6826d57d8da883021f751edcc9c82143b127a/pyct-0.5.0-py2.py3-none-any.whl[00m
[34;01m[  5.89 request          ] 200 - NETWORK - https://files.pythonhosted.org/packages/2f/78/72bec6805be44a11dc80e949752fcaacc21661c3423e26623263d19a73d1/pyviz_comms-2.2.1-py2.py3-none-any.whl[00m
[34;01m[  5.92 request          ] 200 - NETWORK - https://files.pythonhosted.org/packages/ce/a9/2eecc0b0b21f9c256e9de036529a9f35d390a83b51f4591fb739436e51cd/param-1.13.0-py2.py3-none-any.whl[00m
[  5.94 console.log      ] packaging already loaded from default channel
[  5.94 console.log      ] pyparsing already loaded from default channel
[  5.94 console.log      ] Loading numpy, pandas, python-dateutil, six, pytz, pyyaml, typing-extensions, jinja2, markupsafe, pillow, bleach, webencodings, setuptools, distutils, tqdm, idna, certifi
[34;01m[  6.05 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/numpy-1.24.2-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  6.45 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pandas-1.5.3-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  6.60 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/python_dateutil-2.8.2-py2.py3-none-any.whl[00m
[34;01m[  6.62 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/six-1.16.0-py2.py3-none-any.whl[00m
[34;01m[  6.63 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pytz-2023.3-py2.py3-none-any.whl[00m
[34;01m[  6.64 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/PyYAML-6.0-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  6.64 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/typing_extensions-4.5.0-py3-none-any.whl[00m
[34;01m[  6.65 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/Jinja2-3.1.2-py3-none-any.whl[00m
[34;01m[  6.65 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/MarkupSafe-2.1.2-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  6.68 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/PIL-9.1.1-cp311-cp311-emscripten_3_1_32_wasm32.whl[00m
[34;01m[  6.72 request          ] 200 - CACHED - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/distutils-1.0.0.zip[00m
[34;01m[ 33.20 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/idna-3.4-py3-none-any.whl[00m
[34;01m[ 33.20 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/tqdm-4.65.0-py3-none-any.whl[00m
[34;01m[ 33.23 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/bleach-6.0.0-py3-none-any.whl[00m
[34;01m[ 33.24 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/certifi-2022.12.7-py3-none-any.whl[00m
[34;01m[ 33.37 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/setuptools-67.6.1-py3-none-any.whl[00m
[34;01m[ 33.72 request          ] 200 - NETWORK - https://cdn.jsdelivr.net/pyodide/v0.23.0/full/webencodings-0.5.1-py2.py3-none-any.whl[00m

tests/integration/test_py_repl.py::TestPyRepl::test_show_last_expression_with_output[chromium] 
[gw0] [ 60%] PASSED tests/integration/test_py_config.py::TestConfig::test_invalid_json_config[chromium] 
tests/integration/test_zzz_docs_snippets.py::TestDocsSnippets::test_guides_asyncio[chromium] 
[gw0] [ 60%] PASSED tests/integration/test_zzz_docs_snippets.py::TestDocsSnippets::test_guides_asyncio[chromium] 
[gw4] [ 61%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_show_last_expression_with_output[chromium] 
tests/integration/test_01_basic.py::TestBasic::test_python_exception_in_event_handler[chromium] 
tests/integration/test_py_terminal.py::TestPyTerminal::test_py_terminal[chromium] 
[gw4] [ 61%] PASSED tests/integration/test_py_terminal.py::TestPyTerminal::test_py_terminal[chromium] 
[gw0] [ 62%] PASSED tests/integration/test_01_basic.py::TestBasic::test_python_exception_in_event_handler[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_hello_world[chromium] 
tests/integration/test_00_support.py::TestSupport::test_check_js_errors_multiple[chromium] 
[gw0] [ 62%] PASSED tests/integration/test_00_support.py::TestSupport::test_check_js_errors_multiple[chromium] 
tests/integration/test_py_terminal.py::TestPyTerminal::test_config_docked[chromium] 
[gw0] [ 63%] PASSED tests/integration/test_py_terminal.py::TestPyTerminal::test_config_docked[chromium] 
tests/integration/test_03_element.py::TestElement::test_element_innerHtml[chromium] 
[gw4] [ 63%] PASSED tests/integration/test_zz_examples.py::TestExamples::test_hello_world[chromium] 
tests/integration/test_stdio_handling.py::TestOutputHandling::test_targeted_stdio_async[chromium] 
[gw0] [ 64%] PASSED tests/integration/test_03_element.py::TestElement::test_element_innerHtml[chromium] 
tests/integration/test_stdio_handling.py::TestOutputHandling::test_targeted_stdio_solo[chromium] 
[gw4] [ 64%] PASSED tests/integration/test_stdio_handling.py::TestOutputHandling::test_targeted_stdio_async[chromium] 
tests/integration/test_00_support.py::TestSupport::test_iter_locator[chromium] 
[gw4] [ 65%] PASSED tests/integration/test_00_support.py::TestSupport::test_iter_locator[chromium] 
tests/integration/test_py_config.py::TestConfig::test_paths[chromium] 
[gw0] [ 65%] PASSED tests/integration/test_stdio_handling.py::TestOutputHandling::test_targeted_stdio_solo[chromium] 
tests/integration/test_stdio_handling.py::TestOutputHandling::test_stdio_stderr[chromium] 
[gw4] [ 66%] PASSED tests/integration/test_py_config.py::TestConfig::test_paths[chromium] 
tests/integration/test_03_element.py::TestElement::test_element_clone_no_id[chromium] 
[gw0] [ 67%] PASSED tests/integration/test_stdio_handling.py::TestOutputHandling::test_stdio_stderr[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_multiple_repls[chromium] 
[gw4] [ 67%] PASSED tests/integration/test_03_element.py::TestElement::test_element_clone_no_id[chromium] 
tests/integration/test_plugins.py::TestPlugin::test_fetch_js_plugin[chromium] 
[gw0] [ 68%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_multiple_repls[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_show_last_expression[chromium] 
[gw0] [ 68%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_show_last_expression[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_todo_pylist[chromium] 
[gw4] [ 69%] PASSED tests/integration/test_plugins.py::TestPlugin::test_fetch_js_plugin[chromium] 
tests/integration/test_00_support.py::TestSupport::test_wait_for_console_timeout[chromium] 
[gw4] [ 69%] PASSED tests/integration/test_00_support.py::TestSupport::test_wait_for_console_timeout[chromium] 
tests/integration/test_stdio_handling.py::TestOutputHandling::test_stdio_stdout_id_errors[chromium] 
[gw0] [ 70%] XPASS tests/integration/test_zz_examples.py::TestExamples::test_todo_pylist[chromium] 
[gw0] [ 70%] XFAIL tests/integration/test_zz_examples.py::TestExamples::test_todo_pylist[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_display[chromium] 
[gw4] [ 70%] PASSED tests/integration/test_stdio_handling.py::TestOutputHandling::test_stdio_stdout_id_errors[chromium] 
tests/integration/test_03_element.py::TestElement::test_element_clear_div[chromium] 
[gw0] [ 71%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_display[chromium] 
tests/integration/test_00_support.py::TestSupport::test_check_js_errors_simple[chromium] 
[gw0] [ 71%] PASSED tests/integration/test_00_support.py::TestSupport::test_check_js_errors_simple[chromium] 
tests/integration/test_plugins.py::TestPlugin::test_fetch_js_plugin_bare[chromium] 
[gw4] [ 72%] PASSED tests/integration/test_03_element.py::TestElement::test_element_clear_div[chromium] 
tests/integration/test_00_support.py::TestSupport::test_check_js_errors_expected[chromium] 
[gw4] [ 72%] PASSED tests/integration/test_00_support.py::TestSupport::test_check_js_errors_expected[chromium] 
tests/integration/test_importmap.py::TestImportmap::test_importmap[chromium] 
[gw0] [ 73%] PASSED tests/integration/test_plugins.py::TestPlugin::test_fetch_js_plugin_bare[chromium] 
tests/integration/test_02_display.py::TestOutput::test_append_false[chromium] 
[gw4] [ 73%] XFAIL tests/integration/test_importmap.py::TestImportmap::test_importmap[chromium] 
tests/integration/test_02_display.py::TestOutput::test_image_display[chromium] 
[gw0] [ 74%] PASSED tests/integration/test_02_display.py::TestOutput::test_append_false[chromium] 
tests/integration/test_py_config.py::TestConfig::test_py_config_external[chromium] 
[gw0] [ 74%] PASSED tests/integration/test_py_config.py::TestConfig::test_py_config_external[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_repl_output_attribute[chromium] 
[gw4] [ 75%] PASSED tests/integration/test_02_display.py::TestOutput::test_image_display[chromium] 
tests/integration/test_stdio_handling.py::TestOutputHandling::test_stdio_stderr_id_errors[chromium] 
[gw0] [ 75%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_repl_output_attribute[chromium] 
tests/integration/test_py_config.py::TestConfig::test_paths_from_packages[chromium] 
[gw4] [ 76%] PASSED tests/integration/test_stdio_handling.py::TestOutputHandling::test_stdio_stderr_id_errors[chromium] 
tests/integration/test_async.py::TestAsync::test_multiple_async_multiple_display_targeted[chromium] 
[gw0] [ 76%] PASSED tests/integration/test_py_config.py::TestConfig::test_paths_from_packages[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_panel[chromium] 
[gw4] [ 77%] PASSED tests/integration/test_async.py::TestAsync::test_multiple_async_multiple_display_targeted[chromium] 
tests/integration/test_02_display.py::TestOutput::test_target_attribute[chromium] 
[gw4] [ 78%] PASSED tests/integration/test_02_display.py::TestOutput::test_target_attribute[chromium] 
tests/integration/test_zzz_docs_snippets.py::TestDocsSnippets::test_tutorials_requests[chromium] 
[gw4] [ 78%] PASSED tests/integration/test_zzz_docs_snippets.py::TestDocsSnippets::test_tutorials_requests[chromium] 
tests/integration/test_01_basic.py::TestBasic::test_py_attribute_without_id[chromium] 
[gw4] [ 79%] PASSED tests/integration/test_01_basic.py::TestBasic::test_py_attribute_without_id[chromium] 
tests/integration/test_02_display.py::TestOutput::test_empty_HTML_and_console_output[chromium] 
[gw0] [ 79%] PASSED tests/integration/test_zz_examples.py::TestExamples::test_panel[chromium] 
tests/integration/test_03_element.py::TestElement::test_element_select[chromium] 
[gw4] [ 80%] PASSED tests/integration/test_02_display.py::TestOutput::test_empty_HTML_and_console_output[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_repl_stdio_dynamic_tags[chromium] 
[gw0] [ 80%] PASSED tests/integration/test_03_element.py::TestElement::test_element_select[chromium] 
tests/integration/test_01_basic.py::TestBasic::test_deprecated_globals[chromium] 
[gw4] [ 81%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_repl_stdio_dynamic_tags[chromium] 
tests/integration/test_py_terminal.py::TestPyTerminal::test_auto_attribute[chromium] 
[gw0] [ 81%] PASSED tests/integration/test_01_basic.py::TestBasic::test_deprecated_globals[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_multiple_repls_mixed_display_order[chromium] 
[gw4] [ 82%] PASSED tests/integration/test_py_terminal.py::TestPyTerminal::test_auto_attribute[chromium] 
tests/integration/test_stdio_handling.py::TestOutputHandling::test_targeted_stdio_linebreaks[chromium] 
[gw0] [ 82%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_multiple_repls_mixed_display_order[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_simple_clock[chromium] 
[gw4] [ 83%] PASSED tests/integration/test_stdio_handling.py::TestOutputHandling::test_targeted_stdio_linebreaks[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_repl_src_path_that_do_not_exist[chromium] 
[gw4] [ 83%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_repl_src_path_that_do_not_exist[chromium] 
tests/integration/test_zzz_docs_snippets.py::TestDocsSnippets::test_tutorials_py_click[chromium] 
[gw0] [ 84%] PASSED tests/integration/test_zz_examples.py::TestExamples::test_simple_clock[chromium] 
tests/integration/test_zz_examples.py::TestExamples::test_antigravity[chromium] 
[gw4] [ 84%] PASSED tests/integration/test_zzz_docs_snippets.py::TestDocsSnippets::test_tutorials_py_click[chromium] 
tests/integration/test_plugins.py::TestPlugin::test_execution_hooks[chromium] 
[gw0] [ 85%] PASSED tests/integration/test_zz_examples.py::TestExamples::test_antigravity[chromium] 
tests/integration/test_async.py::TestAsync::test_sync_and_async_order[chromium] 
[gw4] [ 85%] PASSED tests/integration/test_plugins.py::TestPlugin::test_execution_hooks[chromium] 
tests/integration/test_00_support.py::TestSupport::test_check_js_errors_expected_not_found_but_other_errors[chromium] 
[gw4] [ 86%] PASSED tests/integration/test_00_support.py::TestSupport::test_check_js_errors_expected_not_found_but_other_errors[chromium] 
tests/integration/test_py_terminal.py::TestPyTerminal::test_config_false[chromium] 
[gw0] [ 86%] PASSED tests/integration/test_async.py::TestAsync::test_sync_and_async_order[chromium] 
tests/integration/test_02_display.py::TestOutput::test_explicit_target_pyscript_tag[chromium] 
[gw4] [ 87%] PASSED tests/integration/test_py_terminal.py::TestPyTerminal::test_config_false[chromium] 
tests/integration/test_py_repl.py::TestPyRepl::test_python_exception_after_previous_output[chromium] 
[gw0] [ 87%] PASSED tests/integration/test_02_display.py::TestOutput::test_explicit_target_pyscript_tag[chromium] 
tests/integration/test_03_element.py::TestElement::test_element_add_single_class[chromium] 
[gw4] [ 88%] PASSED tests/integration/test_py_repl.py::TestPyRepl::test_python_exception_after_previous_output[chromium] 
tests/integration/test_03_element.py::TestElement::test_element_clone_with_id[chromium] 
[gw0] [ 89%] PASSED tests/integration/test_03_element.py::TestElement::test_element_add_single_class[chromium] 
tests/integration/test_splashscreen.py::TestSplashscreen::test_splashscreen_closes_on_error_with_pys_onClick[chromium] 
[gw0] [ 89%] SKIPPED tests/integration/test_splashscreen.py::TestSplashscreen::test_splashscreen_closes_on_error_with_pys_onClick[chromium] 
[gw4] [ 90%] PASSED tests/integration/test_03_element.py::TestElement::test_element_clone_with_id[chromium] 
tests/integration/test_async.py::TestAsync::test_asyncio_gather[chromium] 
[gw4] [ 90%] PASSED tests/integration/test_async.py::TestAsync::test_asyncio_gather[chromium] 